<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enderland | Tienda Oficial</title>
    <link rel="icon" type="image/jpeg" href="https://i.postimg.cc/pTZRVs1F/93db69b6-6f32-44ef-9e5a-ae199feadaa0.jpg">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://bs-community.github.io/skinview3d/js/skinview3d.bundle.js"></script>
    
<style>
        /* --- CONFIGURACIÓN BASE --- */
        :root {
            --primary: #9d00ff;
            --bg-dark: #0f0f0f;
            --bg-sidebar: #161616;
            --card-bg: #1e1e1e;
            --text: #ffffff;
            --text-muted: #b3b3b3;
            --category-title: #ff4747;
            --success: #00ff88;
        }

        * { box-sizing: border-box; }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 10px; border: 2px solid var(--bg-dark); transition: 0.3s; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); box-shadow: 0 0 10px var(--primary); }
        * { scrollbar-width: thin; scrollbar-color: #2a2a2a var(--bg-dark); }

        body {
            margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-dark); color: var(--text);
            display: flex; height: 100vh; overflow: hidden;
        }

        /* --- LOGO FLOTANTE --- */
        .fixed-logo-right {
            position: fixed; top: 20px; right: 30px; width: 80px; height: 80px;
            z-index: 100; filter: drop-shadow(0 0 10px rgba(157,0,255,0.5));
            pointer-events: none;
        }

        /* --- OVERLAYS (LOGIN / TERMS) --- */
        .overlay-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(10px); transition: opacity 0.5s;
        }

        .login-box, .terms-box {
            background: #1a1a1a; padding: 40px; border-radius: 20px;
            border: 1px solid var(--primary); text-align: center;
            width: 90%; max-width: 400px; box-shadow: 0 0 50px rgba(157, 0, 255, 0.3);
        }

        .terms-box { max-width: 600px; text-align: left; }
        .terms-content {
            height: 300px; overflow-y: auto; background: #111; padding: 15px;
            border-radius: 8px; border: 1px solid #333; margin: 20px 0;
            font-size: 0.9rem; color: #ccc; line-height: 1.6;
        }

        .login-avatar-preview {
            width: 100px; height: 100px; border-radius: 15px; margin: 0 auto 20px;
            border: 3px solid var(--primary);
            background-image: url('https://minotar.net/helm/Steve/100.png');
            background-size: cover; transition: background-image 0.3s;
        }

        .login-input {
            width: 100%; padding: 15px; margin-bottom: 20px;
            background: #2a2a2a; border: 2px solid #333; border-radius: 8px;
            color: #fff; font-size: 1.1rem; text-align: center; outline: none;
        }
        .login-input:focus { border-color: var(--primary); }

        .btn-enter, .btn-accept {
            background: var(--primary); color: #fff; border: none; padding: 15px 30px;
            border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer;
            width: 100%; text-transform: uppercase; transition: 0.3s;
        }
        .btn-enter:hover { background: #7a00c7; }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 280px; background-color: var(--bg-sidebar); height: 100%;
            display: flex; flex-direction: column; border-right: 1px solid #2a2a2a;
            padding: 20px; overflow-y: auto; flex-shrink: 0; z-index: 50;
        }

        .sidebar-profile {
            display: flex; align-items: center; gap: 15px;
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-bottom: 30px;
            border: 1px solid #333; cursor: pointer; transition: 0.3s;
        }
        .sidebar-profile:hover { background: rgba(255,255,255,0.1); border-color: var(--primary); }
        
        .mini-avatar {
            width: 40px; height: 40px; border-radius: 8px;
            background-size: cover; border: 1px solid var(--primary); flex-shrink: 0;
        }
        .user-info div { font-weight: bold; font-size: 0.95rem; }
        .user-info span { font-size: 0.75rem; color: var(--success); }

        .brand { text-align: center; margin-bottom: 20px; cursor: pointer; padding: 10px; }
        .brand img { width: 100%; max-width: 240px; filter: drop-shadow(0 0 5px var(--primary)); }

        .nav-category-title {
            color: var(--category-title); font-weight: 800; font-size: 0.85rem;
            margin: 20px 0 10px 10px; text-transform: uppercase; letter-spacing: 1px;
        }

        .nav-item {
            display: flex; align-items: center; gap: 12px; padding: 12px 15px;
            color: var(--text-muted); text-decoration: none; border-radius: 6px;
            transition: 0.2s; cursor: pointer; margin-bottom: 5px; font-size: 0.95rem;
        }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .nav-item.active { background: var(--primary); color: #fff; }
        .nav-item i { width: 20px; text-align: center; }
        
        .support-email { font-size: 0.8rem; color: #888; padding-left: 45px; margin-bottom: 10px; display: block; }

        .submenu-toggle { justify-content: space-between; }
        .submenu-toggle .arrow { font-size: 0.7rem; transition: transform 0.3s; }
        .submenu-toggle.open .arrow { transform: rotate(180deg); }
        .submenu { display: none; padding-left: 20px; margin-top: 5px; border-left: 2px solid #333; margin-left: 15px; }
        .submenu.show { display: block; animation: slideDown 0.3s ease; }
        @keyframes slideDown { from {opacity:0; transform:translateY(-10px);} to {opacity:1; transform:translateY(0);} }

        /* --- MAIN CONTENT --- */
        .main-content { flex-grow: 1; height: 100vh; overflow-y: auto; padding: 40px; scroll-behavior: smooth; display: flex; flex-direction: column;}
        section { margin-bottom: 100px; scroll-margin-top: 40px; }
        
        .section-header {
            border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 30px;
            display: flex; align-items: center; gap: 15px;
        }
        .section-header h2 { margin: 0; font-size: 2rem; text-transform: uppercase; }
        .section-header i { color: var(--primary); font-size: 1.8rem; }

        .welcome-buttons { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
        .welcome-btn {
            background: rgba(157,0,255,0.1); padding: 12px 25px; border-radius: 6px; 
            cursor: pointer; border: 1px solid var(--primary); color: #fff; font-size: 1rem;
            display: flex; align-items: center; gap: 10px; transition: 0.3s; text-decoration: none;
        }
        .welcome-btn:hover { background: var(--primary); transform: translateY(-2px); }

        /* --- WIDGET SERVER STATUS --- */
        .hero-container { display: flex; gap: 20px; flex-wrap: wrap; align-items: stretch; }

        .welcome-text-area {
            flex: 1; min-width: 300px;
            background: linear-gradient(90deg, #1f1f1f, transparent);
            padding: 30px; border-left: 5px solid var(--primary);
            border-radius: 8px; display: flex; flex-direction: column; justify-content: center;
        }

        .server-widget {
            flex: 0 0 300px; background: #151515; border: 1px solid #333;
            border-radius: 12px; padding: 25px; position: relative;
            display: flex; flex-direction: column; justify-content: space-between;
            transition: 0.3s; overflow: hidden; cursor: pointer;
        }
        .server-widget:hover { border-color: var(--primary); box-shadow: 0 0 20px rgba(157, 0, 255, 0.15); transform: translateY(-5px); }

        .widget-bg-icon {
            position: absolute; top: -20px; right: -20px; font-size: 8rem;
            color: rgba(255,255,255,0.03); transform: rotate(15deg); pointer-events: none;
        }

        .status-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }

        .status-badge {
            background: rgba(0, 255, 136, 0.1); color: var(--success);
            padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: bold;
            display: flex; align-items: center; gap: 8px; border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .pulse-dot {
            width: 8px; height: 8px; background-color: var(--success);
            border-radius: 50%; box-shadow: 0 0 0 rgba(0, 255, 136, 0.7);
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(0, 255, 136, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); }
        }

        .status-badge.offline { color: #ff4747; background: rgba(255, 71, 71, 0.1); border-color: rgba(255, 71, 71, 0.3); }
        .status-badge.offline .pulse-dot { background-color: #ff4747; animation: none; }

        .player-stat { font-size: 2.5rem; font-weight: 800; color: #fff; line-height: 1; margin-bottom: 5px; }
        .player-stat span { font-size: 1rem; color: #666; font-weight: normal; }

        .progress-track {
            width: 100%; height: 6px; background: #333; border-radius: 10px;
            margin: 15px 0; overflow: hidden;
        }
        .progress-fill {
            height: 100%; background: var(--primary); width: 0%;
            border-radius: 10px; transition: width 1s ease-in-out;
            box-shadow: 0 0 10px var(--primary);
        }

        .server-info-row {
            display: flex; justify-content: space-between; font-size: 0.85rem;
            color: #888; border-top: 1px solid #2a2a2a; padding-top: 15px; margin-top: auto;
        }

        /* --- PRECIOS & CARDS --- */
        .pricing-toggle {
            background: #111; padding: 10px 20px; border-radius: 50px; border: 1px solid #333;
            display: inline-flex; align-items: center; gap: 15px; margin-bottom: 30px;
        }
        .switch { position: relative; width: 40px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(16px); }
        .price-label.active { color: var(--primary); font-weight: bold; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 25px; }
        .card {
            background: var(--card-bg); border: 1px solid #333; border-radius: 12px; padding: 25px;
            display: flex; flex-direction: column; position: relative; transition: 0.3s;
        }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .card.netherite { border: 1px solid #5a0b0b; background: linear-gradient(145deg, #1e1e1e 0%, #290a0a 100%); }
        .card.netherite h3 { color: #ff5555; }
        .card h3 { font-size: 1.5rem; margin: 0 0 5px 0; color: var(--primary); text-transform: uppercase; }
        
        .price-tag { font-size: 2.5rem; font-weight: 800; margin: 15px 0 20px; color: #fff; display: flex; align-items: baseline; gap: 5px; }
        .currency-symbol { font-size: 1.5rem; color: #888; font-weight: normal; }
        .currency-code { font-size: 1rem; color: #666; font-weight: bold; margin-left: 5px; }

        ul { list-style: none; padding: 0; margin: 0 0 20px 0; flex-grow: 1; }
        li { padding: 8px 0; border-bottom: 1px solid #2a2a2a; color: #ccc; font-size: 0.9rem; display: flex; align-items: center; }
        li i.icon-list { color: var(--primary); width: 25px; text-align: center; margin-right: 10px; }

        .view-kit-btn {
            background: #333; color: #fff; border: none; border-radius: 4px;
            padding: 2px 8px; font-size: 0.75rem; margin-left: auto; cursor: pointer;
            display: flex; align-items: center; gap: 5px; transition: 0.2s;
        }
        .view-kit-btn:hover { background: var(--primary); }

        .btn-add {
            background: transparent; border: 2px solid var(--primary); color: #fff; padding: 12px;
            width: 100%; border-radius: 6px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.3s;
        }
        .btn-add:hover { background: var(--primary); }

        .kit-image-container {
            width: 100%; min-height: 100px; background: #0c0c0c;
            border: 1px solid #333; border-radius: 8px; margin-bottom: 15px;
            display: flex; align-items: center; justify-content: center; overflow: hidden; padding: 5px;
        }
        .kit-image { width: 100%; height: auto; object-fit: contain; display: block; }
        .modal-kit-image { width: 100%; max-width: 400px; height: auto; border-radius: 8px; border: 1px solid var(--primary); margin: 0 auto 20px auto; display: block; background: #000; }

        /* --- FOOTER --- */
        .site-footer { margin-top: auto; border-top: 1px solid #333; background: #111; padding: 40px 20px; color: #888; font-size: 0.9rem; }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; max-width: 1200px; margin: 0 auto; }
        .footer-col h4 { color: #fff; margin-bottom: 15px; font-size: 1.1rem; border-bottom: 2px solid var(--primary); display: inline-block; padding-bottom: 5px; }
        .footer-col p, .footer-col li { margin-bottom: 10px; line-height: 1.5; }
        .footer-col ul { list-style: none; padding: 0; }
        .footer-col a { color: var(--primary); text-decoration: none; cursor: pointer; transition: 0.2s;}
        .footer-col a:hover { text-decoration: underline; color: #fff; }
        .footer-bottom { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #222; font-size: 0.8rem; }

        /* --- MODALES Y FLOTANTES --- */
        .cart-float {
            position: fixed; bottom: 30px; right: 30px; background: var(--primary); width: 60px; height: 60px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.5rem;
            box-shadow: 0 0 20px rgba(0,0,0,0.5); cursor: pointer; z-index: 200; transition: transform 0.2s;
        }
        .cart-float:hover { transform: scale(1.1); }
        .cart-count {
            position: absolute; top: -5px; right: -5px; background: #ff004c; color: white;
            font-size: 0.8rem; width: 22px; height: 22px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; font-weight: bold; border: 2px solid #fff;
        }

        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8);
            z-index: 300; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: #1a1a1a; width: 90%; max-width: 500px; border-radius: 15px; padding: 30px;
            border: 1px solid var(--primary); position: relative; max-height: 85vh; overflow-y: auto;
        }
        .close-modal { position: absolute; top: 20px; right: 20px; font-size: 1.5rem; cursor: pointer; color: #888; }
        .close-modal:hover { color: #fff; }

        #skin-viewer-container { width: 100%; height: 300px; background: #222; border-radius: 10px; border: 1px solid #444; margin-bottom: 10px; position: relative; }
        .faq-answer { color: #ccc; line-height: 1.6; font-size: 1rem; }
        .kit-detail-list li { border-bottom: 1px solid #333; padding: 8px 0; font-size: 0.95rem; display: block; }
        .kit-detail-list strong { color: var(--primary); }
        .kit-detail-list span { color: #aaa; font-size: 0.85rem; display: block; margin-top: 2px; }
        .cart-item { display: flex; justify-content: space-between; padding: 10px; background: #222; margin-bottom: 5px; border-radius: 5px; }
        .gift-section { margin-top: 15px; padding-top: 15px; border-top: 1px solid #333; }
        .gift-toggle { display: flex; align-items: center; gap: 10px; cursor: pointer; color: #ccc; font-size: 0.95rem; user-select: none; }
        .gift-input-field { display: none; width: 100%; padding: 12px; margin-top: 10px; background: #2a2a2a; border: 1px solid #444; border-radius: 5px; color: #fff; outline: none; transition: 0.3s; }
        .gift-input-field:focus { border-color: var(--primary); background: #222; }

        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            .sidebar { width: 100%; height: auto; position: relative; padding: 15px; border-bottom: 1px solid #333; border-right: none; }
            .brand img { max-width: 180px; }
            .sidebar-profile { margin-bottom: 15px; padding: 10px; }
            .main-content { height: auto; padding: 20px 15px; overflow: visible; }
            section { margin-bottom: 60px; }
            .section-header h2 { font-size: 1.5rem; }
            .welcome-buttons { width: 100%; }
            .welcome-btn { width: 100%; justify-content: center; }
            .fixed-logo-right { width: 50px; height: 50px; top: 10px; right: 10px; }
            .hero-container { flex-direction: column; }
            .server-widget { flex: 1 1 100%; }
        }

        /* --- PROMO BANNER (NUEVO) --- */
        .promo-banner {
            background: linear-gradient(90deg, rgba(157,0,255,0.15) 0%, rgba(30,30,30,0.8) 100%);
            border: 1px solid var(--primary);
            border-left: 4px solid #ffd700;
            border-radius: 8px;
            padding: 15px 25px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: slideInFade 0.8s ease-out;
        }

        .promo-banner::after {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 50%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: skewX(-20deg);
            animation: shine 6s infinite;
        }

        .promo-content-wrapper { display: flex; align-items: center; gap: 20px; z-index: 2; }
        
        .promo-icon-box {
            background: rgba(255, 215, 0, 0.1);
            width: 50px; height: 50px;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            border: 1px solid rgba(255, 215, 0, 0.3);
            flex-shrink: 0;
        }

        .promo-icon-box i { color: #ffd700; font-size: 1.5rem; animation: tada 2s infinite; }

        .promo-text h4 { margin: 0 0 5px 0; color: #fff; text-transform: uppercase; letter-spacing: 1px; font-size: 1rem; }
        .promo-text p { margin: 0; color: #bbb; font-size: 0.9rem; }
        .promo-highlight { color: var(--success); font-weight: bold; }

        .promo-counter {
            text-align: right;
            z-index: 2;
            min-width: 120px;
        }
        .counter-badge {
            background: #ffd700; color: #000; padding: 4px 8px;
            border-radius: 4px; font-weight: bold; font-size: 0.8rem;
            display: inline-block; margin-bottom: 5px;
        }
        .progress-mini {
            width: 100%; height: 6px; background: #333; border-radius: 10px; overflow: hidden;
        }
        .progress-mini-fill {
            height: 100%; background: #ffd700;
            box-shadow: 0 0 10px #ffd700;
            transition: width 1s ease-in-out;
        }

        @keyframes shine { 0% { left: -100%; } 20% { left: 200%; } 100% { left: 200%; } }
        @keyframes tada { 0% {transform: scale(1);} 10% {transform: scale(0.9) rotate(-3deg);} 20% {transform: scale(0.9) rotate(-3deg);} 30% {transform: scale(1.1) rotate(3deg);} 40% {transform: scale(1.1) rotate(-3deg);} 50% {transform: scale(1.1) rotate(3deg);} 60% {transform: scale(1.1) rotate(-3deg);} 70% {transform: scale(1.1) rotate(3deg);} 80% {transform: scale(1.1) rotate(-3deg);} 90% {transform: scale(1.1) rotate(3deg);} 100% {transform: scale(1) rotate(0);} }

        @media (max-width: 768px) {
            .promo-banner { flex-direction: column; text-align: center; gap: 15px; }
            .promo-content-wrapper { flex-direction: column; }
            .promo-counter { width: 100%; text-align: center; }
            .progress-mini { margin: 0 auto; width: 80%; }
        }
        
        @keyframes slideInFade {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- ADMIN PANEL & TOASTS --- */
        #admin-panel {
            background: #111;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #333;
        }
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
        }
        .admin-card {
            background: #151515;
            border-radius: 10px;
            border: 1px solid #333;
            padding: 15px 18px;
            font-size: 0.9rem;
        }
        .admin-card h4 {
            margin: 0 0 10px 0;
            color: var(--primary);
            font-size: 1rem;
            text-transform: uppercase;
        }
        .admin-input, .admin-textarea, .admin-select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid #333;
            background: #1d1d1d;
            color: #fff;
            font-size: 0.9rem;
            margin-bottom: 8px;
            outline: none;
        }
        .admin-input:focus, .admin-textarea:focus, .admin-select:focus {
            border-color: var(--primary);
        }
        .admin-textarea {
            min-height: 80px;
            resize: vertical;
        }
        .admin-btn {
            background: var(--primary);
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            color: #fff;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 4px;
        }
        .admin-btn:hover {
            background: #7a00c7;
        }
        .admin-stat-big {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--success);
        }
        .admin-label-small {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        #admin-login-box {
            background: #151515;
            border-radius: 10px;
            border: 1px solid #333;
            padding: 15px 18px;
            max-width: 360px;
        }
        #admin-login-error {
            color: #ff5555;
            font-size: 0.8rem;
            margin-top: 5px;
        }
        #admin-console-log {
            background: #000;
            color: #00ff88;
            font-family: Consolas, "Courier New", monospace;
            font-size: 0.8rem;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #333;
            height: 180px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        #admin-console-log::-webkit-scrollbar-thumb {
            background: #00aa55;
        }

        #toast-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 500;
        }
        .toast {
            background: rgba(21,21,21,0.95);
            border-radius: 8px;
            border: 1px solid var(--primary);
            padding: 10px 14px;
            font-size: 0.85rem;
            color: #fff;
            box-shadow: 0 0 12px rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            gap: 8px;
            animation: slideIn 0.3s ease-out;
        }
        .toast-icon {
            color: var(--success);
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @media (max-width: 768px) {
            #toast-container {
                left: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>

    <img src="https://i.postimg.cc/rw89skN2/logo-enderland-png.png" alt="Logo Enderland" class="fixed-logo-right">

    <div class="overlay-screen" id="login-overlay">
        <div class="login-box">
            <h2 style="margin-top:0; color:var(--primary);">IDENTIFÍCATE</h2>
            <p style="color:#ccc;">Ingresa tu Nick de Minecraft para continuar</p>
            <div class="login-avatar-preview" id="avatar-preview"></div>
            <input type="text" class="login-input" id="nick-input" placeholder="Ej: Steve" maxlength="16" oninput="updateSkin()">
            <button class="btn-enter" onclick="submitLogin()">CONTINUAR</button>
        </div>
    </div>

    <div class="overlay-screen" id="terms-overlay" style="display:none; opacity:0;">
        <div class="terms-box">
            <h2 style="margin-top:0; color:var(--primary); text-align: center;"><i class="fas fa-file-contract"></i> TÉRMINOS DEL SERVICIO</h2>
            <p style="text-align:center; color:#999; margin-top:-10px;">Por favor, lee y acepta para continuar.</p>
            <div class="terms-content">
                <p><strong>1. POLÍTICA DE REEMBOLSOS Y PAGOS</strong><br>
                Todas las ventas son finales. Usted comprende y acepta que no tiene el derecho de reembolsar, cancelar o demandar al servidor por cualquier medio con el fin de recuperar los fondos ya pagados. Al realizar una compra, usted renuncia a cualquier derecho de devolución.</p>
                <p><strong>2. CONSECUENCIAS DE DISPUTAS</strong><br>
                Si usted inicia un contracargo o disputa de pago sin autorización previa, nos reservamos el derecho de prohibirle el acceso a todos nuestros servicios de forma permanente (Ban de usuario e IP). Nos reservamos el derecho de iniciar acciones legales para recuperar daños por devoluciones forzadas.</p>
                <p><strong>3. CAMBIOS EN LOS SERVICIOS</strong><br>
                Nos reservamos el derecho de cambiar, con o sin previo aviso, cualquier precio en la tienda. También nos reservamos el derecho de modificar el contenido de un paquete específico. Los beneficios de un rango o kit pueden cambiar por razones de balance del servidor y usted no tendrá derecho a reclamar los beneficios antiguos.</p>
                <p><strong>4. RESPONSABILIDAD</strong><br>
                Enderland no se hace responsable por la pérdida de ítems dentro del juego debido a muertes, lag, reinicios o errores del usuario. Al comprar, usted apoya el mantenimiento del servidor.</p>
            </div>
            <button class="btn-accept" onclick="enterShop()">HE LEÍDO Y ACEPTO</button>
        </div>
    </div>

    <nav class="sidebar">
        <div class="brand" onclick="resetNavigation()">
            <img src="https://i.postimg.cc/6p55m2zb/texto-enderland.png" alt="Enderland">
        </div>

        <div class="sidebar-profile" onclick="showFullSkin()">
            <div class="mini-avatar" id="sidebar-avatar" style="background-image: url('https://minotar.net/helm/Steve/40.png');"></div>
            <div class="user-info">
                <div id="sidebar-username">Jugador</div>
                <span>En línea</span>
            </div>
        </div>

        <div class="nav-category-title">NAVEGACIÓN</div>
        <a href="#inicio" class="nav-item active" id="btn-inicio">
            <i class="fas fa-home"></i> Inicio
        </a>

        <div class="nav-category-title">TIENDA</div>
        
        <div class="nav-item submenu-toggle" id="toggle-rangos" onclick="toggleSubmenu('rangos')">
            <div style="display:flex; gap:12px; align-items:center;">
                <i class="fas fa-shield-alt"></i> RANGOS
            </div>
            <i class="fas fa-chevron-down arrow"></i>
        </div>
        <div class="submenu" id="submenu-rangos">
            <a href="#semi-anarquico" class="nav-item">Semi-Anárquico</a>
            <a href="#vanilla-rangos" class="nav-item">Vanilla</a>
        </div>

        <div class="nav-item submenu-toggle" id="toggle-kits" onclick="toggleSubmenu('kits')">
            <div style="display:flex; gap:12px; align-items:center;">
                <i class="fas fa-box-open"></i> KITS
            </div>
            <i class="fas fa-chevron-down arrow"></i>
        </div>
        <div class="submenu" id="submenu-kits">
            <a href="#semi-kits" class="nav-item">Semi-Anárquico</a>
            <a href="#vanilla-kits" class="nav-item">Vanilla</a>
        </div>

        <div class="nav-category-title">SOPORTE</div>
        <a href="https://discord.gg/PJ3JfM2BbJ" target="_blank" class="nav-item">
            <i class="fab fa-discord"></i> Discord
        </a>
        <div class="nav-item" style="cursor: default;">
            <i class="fas fa-envelope"></i> Mail
        </div>
        <a href="mailto:Soporte@enderland.org" class="support-email">Soporte@enderland.org</a>
    </nav>

    <main class="main-content" id="scroll-container">
        
        <section id="inicio">
            <div class="section-header">
                <i class="fas fa-info-circle"></i>
                <h2>Bienvenido</h2>
            </div>
            
            <div class="promo-banner">
            <div class="promo-content-wrapper">
                <div class="promo-icon-box">
                    <i class="fas fa-gift"></i>
                </div>
                <div class="promo-text">
                    <h4>¡Evento de Apertura!</h4>
                    <p>Las primeras <strong>10 personas</strong> que hagan una compra mayor a <span class="promo-highlight">$5 USD</span> se llevan un kit de regalo.</p>
                </div>
            </div>
            <div class="promo-counter">
                <span class="counter-badge">¡Solo quedan 8 cupos!</span>
                <div style="font-size: 0.75rem; color: #888; margin-bottom: 3px;">2 / 10 Reclamados</div>
                <div class="progress-mini">
                    <div class="progress-mini-fill" style="width: 80%;"></div>
                </div>
            </div>
        </div>

            <div class="hero-container">
                <div class="welcome-text-area">
                    <h3 style="margin-top: 0; color: var(--primary); font-size: 1.5rem;">ENDERLAND STORE</h3>
                    <p style="color: #ccc; line-height: 1.6; font-size: 1.1rem;">
                        Seleccioná una categoría del menú de la izquierda para ver los paquetes.
                        <br>Tus compras ayudan a mantener el servidor online y sin lag.
                    </p>
                    <div class="welcome-buttons">
                        <div class="welcome-btn" onclick="copyIP()">
                            IP: <strong>play.enderland.org</strong> <i class="far fa-copy" style="margin-left: 10px;"></i>
                        </div>
                        <a href="https://discord.gg/PJ3JfM2BbJ" target="_blank" class="welcome-btn" style="background: #5865F2; border-color: #5865F2;">
                            <i class="fab fa-discord"></i> Unirse a Discord
                        </a>
                    </div>
                </div>

                <div class="server-widget" onclick="openServerModal()">
                    <i class="fas fa-gamepad widget-bg-icon"></i>
                    
                    <div class="status-header">
                        <span style="color: #aaa; font-size: 0.9rem;">ESTADO DEL SERVIDOR</span>
                        <div class="status-badge" id="server-status-badge">
                            <div class="pulse-dot"></div> <span id="server-status-text">Cargando...</span>
                        </div>
                    </div>

                    <div>
                        <div class="player-stat" id="player-count">--</div>
                        <div style="color: #888; font-size: 0.9rem;">JUGADORES EN LÍNEA</div>
                    </div>

                    <div class="progress-track">
                        <div class="progress-fill" id="player-progress"></div>
                    </div>

                    <div class="server-info-row">
                        <span><i class="fas fa-signal" style="color:var(--primary)"></i> <span id="server-ping">-- ms</span></span>
                        <span id="server-version">1.20.x</span>
                    </div>
                </div>
            </div>
        </section>

        <section id="semi-anarquico">
            <div class="section-header">
                <i class="fas fa-skull"></i>
                <h2>Rangos Semi-Anárquico</h2>
            </div>
            <div class="pricing-toggle">
                <span class="price-label active" id="label-month-semi">Mensual</span>
                <label class="switch">
                    <input type="checkbox" id="price-switch-semi" onclick="togglePrice(this)">
                    <span class="slider"></span>
                </label>
                <span class="price-label" id="label-perm-semi">Permanente</span>
            </div>
            <div class="grid">
                <div class="card">
                    <h3>Cobre</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="1.00" data-p="1.60">1.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-box icon-list"></i> Kit Cobre <button class="view-kit-btn" onclick="showKitDetails('cobre')"><i class="fas fa-eye"></i> Ver</button></li>
                        <li><i class="fas fa-check icon-list"></i> Prefijo [COBRE]</li>
                        <li><i class="fas fa-home icon-list"></i> 5 Sethomes</li>
                        <li><i class="fas fa-hat-wizard icon-list"></i> /hat</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Rango Cobre (Semi)', this)">Añadir</button>
                </div>
                <div class="card">
                    <h3>Hierro</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="2.50" data-p="4.00">2.50</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-box icon-list"></i> Kit Hierro <button class="view-kit-btn" onclick="showKitDetails('hierro')"><i class="fas fa-eye"></i> Ver</button></li>
                        <li><i class="fas fa-arrow-up icon-list"></i> Todo lo de Cobre</li>
                        <li><i class="fas fa-home icon-list"></i> 8 Sethomes</li>
                        <li><i class="fas fa-tools icon-list"></i> /workbench</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Rango Hierro (Semi)', this)">Añadir</button>
                </div>
                <div class="card">
                    <h3>Oro</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="4.00" data-p="6.50">4.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-box icon-list"></i> Kit Oro <button class="view-kit-btn" onclick="showKitDetails('oro')"><i class="fas fa-eye"></i> Ver</button></li>
                        <li><i class="fas fa-arrow-up icon-list"></i> Todo lo de Hierro</li>
                        <li><i class="fas fa-home icon-list"></i> 12 Sethomes</li>
                        <li><i class="fas fa-box-open icon-list"></i> /enderchest</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Rango Oro (Semi)', this)">Añadir</button>
                </div>
                <div class="card">
                    <h3 style="color: #00e5ff;">Diamante</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="6.00" data-p="9.50">6.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-box icon-list"></i> Kit Diamante <button class="view-kit-btn" onclick="showKitDetails('diamante')"><i class="fas fa-eye"></i> Ver</button></li>
                        <li><i class="fas fa-arrow-up icon-list"></i> Todo lo de Oro</li>
                        <li><i class="fas fa-skull icon-list"></i> /back al morir</li>
                        <li><i class="fas fa-bolt icon-list"></i> Tp instantáneo</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Rango Diamante (Semi)', this)">Añadir</button>
                </div>
                <div class="card">
                    <h3 style="color: #00ff88;">Esmeralda</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="8.00" data-p="12.50">8.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-box icon-list"></i> Kit Esmeralda <button class="view-kit-btn" onclick="showKitDetails('esmeralda')"><i class="fas fa-eye"></i> Ver</button></li>
                        <li><i class="fas fa-arrow-up icon-list"></i> Todo lo de Diamante</li>
                        <li><i class="fas fa-utensils icon-list"></i> /feed y /near</li>
                        <li><i class="fas fa-home icon-list"></i> 40 Sethomes</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Rango Esmeralda (Semi)', this)">Añadir</button>
                </div>
                <div class="card netherite">
                    <h3>Netherite</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="10.00" data-p="16.00">10.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-crown icon-list"></i> <strong>Kit Netherite</strong> <button class="view-kit-btn" onclick="showKitDetails('netherite')"><i class="fas fa-eye"></i> Ver</button></li>
                        <li><i class="fas fa-arrow-up icon-list"></i> Todo lo anterior</li>
                        <li><i class="fas fa-home icon-list"></i> 100 Sethomes</li>
                        <li><i class="fas fa-hammer icon-list"></i> /repair</li>
                        <li><i class="fas fa-feather icon-list"></i> Fly en Lobby</li>
                        <li><i class="fas fa-mask icon-list"></i> /nick + KIT OP</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Rango Netherite (Semi)', this)">Añadir</button>
                </div>
            </div>
        </section>

        <section id="vanilla-rangos">
            <div class="section-header">
                <i class="fas fa-leaf"></i>
                <h2>Rangos Vanilla</h2>
            </div>
            <div class="pricing-toggle">
                <span class="price-label active" id="label-month-vanilla">Mensual</span>
                <label class="switch">
                    <input type="checkbox" id="price-switch-vanilla" onclick="togglePrice(this)">
                    <span class="slider"></span>
                </label>
                <span class="price-label" id="label-perm-vanilla">Permanente</span>
            </div>
            <div class="grid">
                <div class="card">
                    <h3>Aprendiz</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="1.00" data-p="1.60">1.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-seedling icon-list"></i> Kit Aprendiz <button class="view-kit-btn" onclick="showKitDetails('aprendiz')"><i class="fas fa-eye"></i> Ver</button></li>
                        <li><i class="fas fa-home icon-list"></i> 5 Sethomes</li>
                        <li><i class="fas fa-map-marker-alt icon-list"></i> /tpahere (Traer jugador)</li>
                        <li><i class="fas fa-hat-wizard icon-list"></i> /hat (Bloque cabeza)</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Rango Aprendiz (Vanilla)', this)">Añadir</button>
                </div>
                <div class="card">
                    <h3>Explorador</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="2.50" data-p="4.00">2.50</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-compass icon-list"></i> Kit Explorador <button class="view-kit-btn" onclick="showKitDetails('explorador')"><i class="fas fa-eye"></i> Ver</button></li>
                        <li><i class="fas fa-arrow-up icon-list"></i> Todo lo de Aprendiz</li>
                        <li><i class="fas fa-home icon-list"></i> 8 Sethomes</li>
                        <li><i class="fas fa-tools icon-list"></i> /workbench (Mesa virtual)</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Rango Explorador (Vanilla)', this)">Añadir</button>
                </div>
                <div class="card">
                    <h3>Guerrero</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="4.00" data-p="6.50">4.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-shield-alt icon-list"></i> Kit Guerrero <button class="view-kit-btn" onclick="showKitDetails('guerrero')"><i class="fas fa-eye"></i> Ver</button></li>
                        <li><i class="fas fa-arrow-up icon-list"></i> Todo lo de Explorador</li>
                        <li><i class="fas fa-home icon-list"></i> 12 Sethomes</li>
                        <li><i class="fas fa-box-open icon-list"></i> /enderchest (Virtual)</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Rango Guerrero (Vanilla)', this)">Añadir</button>
                </div>
                <div class="card">
                    <h3 style="color: #a335ee;">Épico</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="6.00" data-p="9.50">6.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-gem icon-list"></i> Kit Épico <button class="view-kit-btn" onclick="showKitDetails('epico')"><i class="fas fa-eye"></i> Ver</button></li>
                        <li><i class="fas fa-arrow-up icon-list"></i> Todo lo de Guerrero</li>
                        <li><i class="fas fa-home icon-list"></i> 20 Sethomes</li>
                        <li><i class="fas fa-skull icon-list"></i> /back (Volver al morir)</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Rango Épico (Vanilla)', this)">Añadir</button>
                </div>
                <div class="card">
                    <h3 style="color: #ffd700;">Héroe</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="8.00" data-p="12.50">8.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-medal icon-list"></i> Kit Héroe <button class="view-kit-btn" onclick="showKitDetails('heroe')"><i class="fas fa-eye"></i> Ver</button></li>
                        <li><i class="fas fa-arrow-up icon-list"></i> Todo lo de Épico</li>
                        <li><i class="fas fa-home icon-list"></i> 40 Sethomes</li>
                        <li><i class="fas fa-utensils icon-list"></i> /feed (Saciar hambre)</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Rango Héroe (Vanilla)', this)">Añadir</button>
                </div>
                <div class="card netherite">
                    <h3>Leyenda</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="10.00" data-p="16.00">10.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-crown icon-list"></i> <strong>Kit Leyenda</strong> <button class="view-kit-btn" onclick="showKitDetails('leyenda')"><i class="fas fa-eye"></i> Ver</button></li>
                        <li><i class="fas fa-arrow-up icon-list"></i> Todo lo anterior</li>
                        <li><i class="fas fa-home icon-list"></i> 100 Sethomes</li>
                        <li><i class="fas fa-hammer icon-list"></i> /repair (Reparar mano)</li>
                        <li><i class="fas fa-feather icon-list"></i> /fly (Volar en Lobby)</li>
                        <li><i class="fas fa-palette icon-list"></i> Chat de Colores</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Rango Leyenda (Vanilla)', this)">Añadir</button>
                </div>
            </div>
        </section>

        <section id="semi-kits">
            <div class="section-header">
                <i class="fas fa-box-open"></i>
                <h2>Kits Semi-Anárquico</h2>
            </div>
            <div class="grid">
                <div class="card">
                    <div class="kit-image-container">
                        <img src="https://i.postimg.cc/d1mtksDL/8370afda-5426-43f0-b420-7353385b51c2.jpg" alt="Kit Pociones" class="kit-image">
                    </div>
                    <h3>Kit Pociones</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="1.00" data-p="1.00">1.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-flask icon-list"></i> 10x Curación Instantánea II</li>
                        <li><i class="fas fa-ghost icon-list"></i> 7x Invisibilidad (8:00)</li>
                        <li><i class="fas fa-bolt icon-list"></i> 4x Velocidad II (1:30)</li>
                        <li><i class="fas fa-fist-raised icon-list"></i> 6x Fuerza II (1:30)</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Kit Pociones (Semi)', this)">Añadir</button>
                </div>
                <div class="card">
                    <div class="kit-image-container">
                        <img src="https://i.postimg.cc/7ZFxKG2C/1b63c615-8ef0-4ebe-a96b-8b8226f666ba.jpg" alt="Kit Comida" class="kit-image">
                    </div>
                    <h3>Kit Comida</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="1.50" data-p="1.50">1.50</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-apple-alt icon-list"></i> 6 Stacks Manzanas Doradas</li>
                        <li><i class="fas fa-magic icon-list"></i> 3 Stacks Manzanas Encantadas</li>
                        <li><i class="fas fa-drumstick-bite icon-list"></i> 6 Stacks Chuletas, 6 Stacks Papas</li>
                        <li><i class="fas fa-seedling icon-list"></i> 3 Stacks Polvo Hueso</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Kit Comida (Semi)', this)">Añadir</button>
                </div>
            </div>
        </section>

        <section id="vanilla-kits">
            <div class="section-header">
                <i class="fas fa-archive"></i>
                <h2>Kits Vanilla</h2>
            </div>
            <div class="grid">
                <div class="card netherite">
                    <div class="kit-image-container">
                         <img src="https://i.postimg.cc/mkBk8cKS/Captura-de-pantalla-2026-02-02-203219.png" alt="Kit Intoxicado" class="kit-image">
                    </div>
                    <h3 style="color: #ff3333;">Kit Intoxicado</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="20.00" data-p="20.00">20.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-tshirt icon-list"></i> <strong>Full Netherite</strong></li>
                        <li><i class="fas fa-magic icon-list"></i> Encantamientos TOP</li>
                        <li>
                            <button class="view-kit-btn" style="width:100%; justify-content:center; margin-top:5px; background:rgba(255,255,255,0.1);" onclick="showKitDetails('intoxicado')">
                                <i class="fas fa-search"></i> Ver encantamientos exactos
                            </button>
                        </li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Kit Intoxicado (Vanilla)', this)">Añadir</button>
                </div>
                <div class="card">
                    <div class="kit-image-container">
                        <img src="https://i.postimg.cc/d1mtksDL/8370afda-5426-43f0-b420-7353385b51c2.jpg" alt="Kit Pociones" class="kit-image">
                    </div>
                    <h3>Kit Pociones</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="1.00" data-p="1.00">1.00</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-flask icon-list"></i> 10x Curación Instantánea II</li>
                        <li><i class="fas fa-ghost icon-list"></i> 7x Invisibilidad (8:00)</li>
                        <li><i class="fas fa-bolt icon-list"></i> 4x Velocidad II (1:30)</li>
                        <li><i class="fas fa-fist-raised icon-list"></i> 6x Fuerza II (1:30)</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Kit Pociones (Vanilla)', this)">Añadir</button>
                </div>
                <div class="card">
                    <div class="kit-image-container">
                        <img src="https://i.postimg.cc/7ZFxKG2C/1b63c615-8ef0-4ebe-a96b-8b8226f666ba.jpg" alt="Kit Comida" class="kit-image">
                    </div>
                    <h3>Kit Comida</h3>
                    <div class="price-tag">
                        <span class="currency-symbol">$</span><span class="amount" data-m="1.50" data-p="1.50">1.50</span><span class="currency-code">USD</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-apple-alt icon-list"></i> 6 Stacks Manzanas Doradas</li>
                        <li><i class="fas fa-magic icon-list"></i> 3 Stacks Manzanas Encantadas</li>
                        <li><i class="fas fa-drumstick-bite icon-list"></i> 6 Stacks Chuletas, 6 Stacks Papas</li>
                        <li><i class="fas fa-seedling icon-list"></i> 3 Stacks Polvo Hueso</li>
                    </ul>
                    <button class="btn-add" onclick="addToCart('Kit Comida (Vanilla)', this)">Añadir</button>
                </div>
            </div>
        </section>


        <section id="admin-panel">
            <div class="section-header">
                <i class="fas fa-lock"></i>
                <h2>Panel Administrativo</h2>
            </div>
            <div id="admin-login-box">
                <div class="admin-label-small">Acceso restringido Staff</div>
                <input type="password" id="admin-password" class="admin-input" placeholder="Contraseña de administración">
                <button class="admin-btn" onclick="adminLogin()">Entrar</button>
                <div id="admin-login-error"></div>
            </div>
            <div id="admin-content" style="display:none; margin-top:20px;">
                <div class="admin-grid">
                    <div class="admin-card">
                        <h4>Estadísticas</h4>
                        <div class="admin-label-small">Total recaudado</div>
                        <div class="admin-stat-big">$<span id="stat-total">0.00</span> USD</div>
                        <div class="admin-label-small" style="margin-top:10px;">Cupón más usado</div>
                        <div id="stat-top-coupon" style="font-size:0.95rem; color:#ccc;">Sin datos</div>
                        <div class="admin-label-small" style="margin-top:10px;">Top 3 productos</div>
                        <ol id="stat-top-products" style="padding-left:18px; margin:5px 0 0 0; color:#ccc; font-size:0.85rem;"></ol>
                    </div>
                    <div class="admin-card">
                        <h4>Gestión de Catálogo</h4>
                        <div class="admin-label-small">Categoría</div>
                        <input type="text" id="admin-category-name" class="admin-input" placeholder="Ej: Semi-Anárquico Kits" />
                        <input type="text" id="admin-category-key" class="admin-input" placeholder="ID interno (sin espacios)" />
                        <hr style="border-color:#333; margin:8px 0;">
                        <div class="admin-label-small">Nuevo Kit</div>
                        <input type="text" id="admin-kit-name" class="admin-input" placeholder="Nombre del kit">
                        <input type="text" id="admin-kit-image" class="admin-input" placeholder="URL de la imagen">
                        <input type="number" step="0.01" id="admin-kit-price" class="admin-input" placeholder="Precio en USD">
                        <textarea id="admin-kit-description" class="admin-textarea" placeholder="Lista de beneficios (una línea por beneficio)"></textarea>
                        <button class="admin-btn" onclick="saveNewKit()">Guardar kit en catálogo</button>
                        <div id="admin-kit-status" style="font-size:0.8rem; color:#888; margin-top:5px;"></div>
                        <div id="admin-catalog-list" style="margin-top:10px; font-size:0.8rem; color:#ccc;"></div>
                    </div>
                    <div class="admin-card">
                        <h4>Cupones</h4>
                        <div class="admin-label-small">Nuevo cupón</div>
                        <input type="text" id="admin-coupon-code" class="admin-input" placeholder="Código (ej: ENDER10)">
                        <input type="number" step="1" id="admin-coupon-percent" class="admin-input" placeholder="% Descuento (ej: 10)">
                        <button class="admin-btn" onclick="saveCoupon()">Guardar cupón</button>
                        <div id="admin-coupon-status" style="font-size:0.8rem; color:#888; margin-top:5px;"></div>
                        <div class="admin-label-small" style="margin-top:10px;">Cupones activos</div>
                        <div id="admin-coupons-list" style="margin-top:5px; font-size:0.8rem; color:#ccc;"></div>
                    </div>
                    <div class="admin-card">
                        <h4>Consola de Monitoreo Staff</h4>
                        <div class="admin-label-small">Logs en tiempo real (system_logs)</div>
                        <div id="admin-console-log"></div>
                    </div>
                </div>
            </div>
        </section>

        <footer class="site-footer">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Preguntas Frecuentes</h4>
                    <ul>
                        <li><a onclick="openFAQ('buy')">¿Cómo comprar?</a></li>
                        <li><a onclick="openFAQ('discord')">¿Cómo unirme al Discord?</a></li>
                        <li><a onclick="openFAQ('payment')">¿Métodos de pago?</a></li>
                        <li><a onclick="openFAQ('security')">¿Es seguro?</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Ubicación</h4>
                    <p><i class="fas fa-map-marker-alt"></i> Estados Unidos</p>
                    <p>Servidores alojados en USA para mejor conectividad global.</p>
                </div>
                <div class="footer-col">
                    <h4>Contáctanos</h4>
                    <p>Ante cualquier duda o problema con tu compra:</p>
                    <a href="mailto:Soporte@enderland.org"><i class="fas fa-envelope"></i> Soporte@enderland.org</a>
                    <br>
                    <a href="https://discord.gg/PJ3JfM2BbJ" target="_blank"><i class="fab fa-discord"></i> Ticket en Discord</a>
                </div>
            </div>
            <div class="footer-bottom">
                &copy; 2026 Enderland. Todos los derechos reservados. No afiliado con Mojang AB.
            </div>
        </footer>

    </main>

    <div class="cart-float" onclick="openCart()">
        <i class="fas fa-shopping-cart"></i>
        <div class="cart-count" id="cart-count">0</div>
    </div>

    <div class="modal" id="cart-modal">
        <div class="modal-content">
            <i class="fas fa-times close-modal" onclick="closeModal('cart-modal')"></i>
            <h3 style="margin:0 0 20px 0; border-bottom: 1px solid #333; padding-bottom: 10px;">Tu Carrito</h3>
            <div style="background: #222; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 0.9rem; color: #ccc;">
                Comprando como: <strong id="cart-username" style="color: var(--primary);">...</strong>
            </div>
            <div id="cart-items-container" style="max-height: 250px; overflow-y: auto;">
                <p style="text-align: center; color: #666;">Vacío</p>
            </div>
            <div class="gift-section">
                <label class="gift-toggle">
                    <input type="checkbox" id="is-gift" onchange="toggleGiftInput()">
                    <span><i class="fas fa-gift" style="color: #ff4747;"></i> ¿Es un regalo para otro jugador?</span>
                </label>
                <input type="text" id="gift-nickname" class="gift-input-field" placeholder="Ingresa el Nick exacto del destinatario...">
            </div>
            <div class="coupon-section" style="margin-top:15px; padding-top:10px; border-top:1px solid #333;">
                <label style="font-size:0.9rem; color:#ccc;">Cupón de descuento</label>
                <div style="display:flex; gap:8px; margin-top:5px;">
                    <input type="text" id="cart-coupon-input" class="gift-input-field" style="display:block; margin-top:0;" placeholder="Ej: ENDER10">
                    <button type="button" class="admin-btn" style="padding:8px 12px; font-size:0.8rem;" onclick="applyCouponFromCart()">Aplicar</button>
                </div>
                <div id="cart-coupon-status" style="font-size:0.8rem; color:#888; margin-top:4px;"></div>
            </div>
            <div style="margin-top: 20px; text-align: right; font-size: 1.2rem; font-weight: bold; color: var(--success);">
                Total: $<span id="cart-total-price">0.00</span>
            </div>
            <button onclick="checkout()" style="width: 100%; padding: 15px; margin-top: 20px; background: var(--success); border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                <i class="fab fa-discord"></i> GENERAR PEDIDO
            </button>
        </div>
    </div>

    <div class="modal" id="kit-modal">
        <div class="modal-content">
            <i class="fas fa-times close-modal" onclick="closeModal('kit-modal')"></i>
            <h3 id="kit-modal-title" style="margin:0 0 15px 0; color: var(--primary); text-transform: uppercase;">CONTENIDO DEL KIT</h3>
            <img src="" id="kit-modal-img" class="modal-kit-image" style="display:none;" alt="Contenido del Kit">
            <ul class="kit-detail-list" id="kit-modal-list"></ul>
        </div>
    </div>

    <div class="modal" id="faq-modal">
        <div class="modal-content">
            <i class="fas fa-times close-modal" onclick="closeModal('faq-modal')"></i>
            <h3 id="faq-title" style="margin:0 0 15px 0; color: var(--primary); text-transform: uppercase;">PREGUNTA FRECUENTE</h3>
            <div id="faq-body" class="faq-answer">
                </div>
        </div>
    </div>

    <div class="modal" id="skin-modal">
        <div class="modal-content" style="text-align: center;">
            <i class="fas fa-times close-modal" onclick="closeModal('skin-modal')"></i>
            <h3 style="margin:0 0 20px 0; border-bottom: 1px solid #333; padding-bottom: 10px; color: var(--primary);">TU SKIN EN VIVO</h3>
            <div id="skin-viewer-container">
                <canvas id="skin_container"></canvas>
            </div>
            <h3 id="skin-username-display" style="margin-top: 10px;"></h3>
            <p style="color: #666; font-size: 0.8rem;">Arrastra para girar • Rueda para zoom</p>
        </div>
    </div>

    <div class="modal" id="server-modal">
        <div class="modal-content">
            <i class="fas fa-times close-modal" onclick="closeModal('server-modal')"></i>
            <h3 style="margin:0 0 10px 0; color: var(--primary); text-transform: uppercase;">
                <i class="fas fa-network-wired"></i> DETALLES DEL SERVIDOR
            </h3>
            
            <div style="background: #222; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                <div style="color: #888; font-size: 0.9rem; margin-bottom: 5px;">Descripcion</div>
                <div id="server-motd" style="font-family: monospace; white-space: pre-wrap; color: #fff;">Cargando...</div>
                <div style="margin-top: 15px; font-size: 0.85rem; color: #666;">
                    IP: <span style="color: #fff; font-weight: bold;">play.enderland.org</span>
                </div>
            </div>

            <h4 style="border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px;">
                JUGADORES CONECTADOS (<span id="modal-online-count">0</span>)
            </h4>
            
            <div id="player-list-container" style="max-height: 250px; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px;">
                <p style="color: #666; width: 100%; text-align: center;">Cargando lista...</p>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <!-- Firebase (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

    <script>
        // --- PROTECCIÓN DE SEGURIDAD Y OFUSCACIÓN ---
        (function() {
            // Bloqueo de Clic Derecho
            document.addEventListener('contextmenu', e => e.preventDefault());

            // Anti-Debugger / Detección de Consola
            let devtoolsOpen = false;
            const threshold = 160;
            setInterval(() => {
                const widthThreshold = window.outerWidth - window.innerWidth > threshold;
                const heightThreshold = window.outerHeight - window.innerHeight > threshold;
                if (widthThreshold || heightThreshold) {
                    if (!devtoolsOpen) {
                        devtoolsOpen = true;
                        console.clear();
                        const user = typeof globalUser !== 'undefined' ? globalUser : 'Invitado';
                        if (typeof logSystem === 'function') {
                            logSystem('security_alert', 'POSIBLE INTENTO DE INSPECCIÓN - Usuario: ' + user);
                        }
                    }
                } else {
                    devtoolsOpen = false;
                }
            }, 1000);

            // Generación de Token de Sesión (Session Key)
            window._sK = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        })();

        // --- FIREBASE CONFIG (OFUSCADA) ---
        const _cA = {
            aK: "AIzaSyCOkYiVzU0wrALPeTBcGNIqK-NhV7QBIVs",
            aD: "enderland-7c875.firebaseapp.com",
            dU: "https://enderland-7c875-default-rtdb.firebaseio.com",
            pI: "enderland-7c875",
            sB: "enderland-7c875.firebasestorage.app",
            mS: "90498636412",
            aI: "1:90498636412:web:41081a7ff3693104bb87f9",
            mI: "G-HT5SQYX3KQ"
        };

        firebase.initializeApp({
            apiKey: _cA.aK,
            authDomain: _cA.aD,
            databaseURL: _cA.dU,
            projectId: _cA.pI,
            storageBucket: _cA.sB,
            messagingSenderId: _cA.mS,
            appId: _cA.aI,
            measurementId: _cA.mI
        });
        
        const db = firebase.database();
        const dbRefs = {
            catalog: db.ref('catalog'),
            offers: db.ref('offers'),
            coupons: db.ref('coupons'),
            recentPurchases: db.ref('recent_purchases'),
            ipOrders: db.ref('ip_orders'),
            systemLogs: db.ref('system_logs')
        };

        const ADMIN_HASH = "4953d408ae0f9d234edbf73468604f9d";

        const WEBHOOK_URL = "https://discord.com/api/webhooks/1471400851862982751/lLxuD7WDa8KB-EjmASttayGws8vrCVzNev6lrZZaqMQ8VyvwLgIIe0X69z_VUYjIJjtt";

        // Precios oficiales para validación de seguridad (Cybersecurity Expert mode)
        const OFFICIAL_PRICES = {
            "Rango Cobre (Semi)": { "Mensual": 1.50, "Permanente": 2.50 },
            "Rango Hierro (Semi)": { "Mensual": 2.50, "Permanente": 4.00 },
            "Rango Oro (Semi)": { "Mensual": 4.00, "Permanente": 6.50 },
            "Rango Diamante (Semi)": { "Mensual": 6.00, "Permanente": 9.50 },
            "Rango Esmeralda (Semi)": { "Mensual": 8.00, "Permanente": 12.50 },
            "Rango Netherite (Semi)": { "Mensual": 10.00, "Permanente": 16.00 },
            "Rango Aprendiz (Vanilla)": { "Mensual": 1.00, "Permanente": 1.60 },
            "Rango Explorador (Vanilla)": { "Mensual": 2.50, "Permanente": 4.00 },
            "Rango Guerrero (Vanilla)": { "Mensual": 4.00, "Permanente": 6.50 },
            "Rango Épico (Vanilla)": { "Mensual": 6.00, "Permanente": 9.50 },
            "Rango Héroe (Vanilla)": { "Mensual": 8.00, "Permanente": 12.50 },
            "Rango Leyenda (Vanilla)": { "Mensual": 10.00, "Permanente": 16.00 },
            "Kit Pociones (Semi)": 1.00,
            "Kit Comida (Semi)": 1.50,
            "Kit Intoxicado (Vanilla)": 20.00,
            "Kit Pociones (Vanilla)": 1.00,
            "Kit Comida (Vanilla)": 1.50
        };

        const STATIC_PRODUCT_NAMES = [
            "Rango Cobre (Semi)", "Rango Hierro (Semi)", "Rango Oro (Semi)", "Rango Diamante (Semi)",
            "Rango Esmeralda (Semi)", "Rango Netherite (Semi)",
            "Rango Aprendiz (Vanilla)", "Rango Explorador (Vanilla)", "Rango Guerrero (Vanilla)",
            "Rango Épico (Vanilla)", "Rango Héroe (Vanilla)", "Rango Leyenda (Vanilla)",
            "Kit Pociones (Semi)", "Kit Comida (Semi)",
            "Kit Intoxicado (Vanilla)", "Kit Pociones (Vanilla)", "Kit Comida (Vanilla)"
        ];

        async function hashStringSHA512(str) {
            const encoder = new TextEncoder();
            const data = encoder.encode(str);
            const hashBuffer = await crypto.subtle.digest("SHA-512", data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
        }

        function initFirebaseRealtime() {
            // Social proof: toasts en tiempo real
            dbRefs.recentPurchases.limitToLast(5).on('child_added', snap => {
                const order = snap.val();
                if (!order) return;
                // Sólo toasts de compras recientes (últimos 30s)
                const now = Date.now();
                if (order.createdAt && (now - order.createdAt) <= 30000) {
                    showPurchaseToast(order);
                }
            });

            // Cupones
            dbRefs.coupons.on('value', snap => {
                couponsCache = snap.val() || {};
                renderCouponsList(couponsCache);
            });

            // Render catálogo dinámico + panel admin + menú lateral
            dbRefs.catalog.on('value', snapshot => {
                const catalog = snapshot.val() || {};
                currentCatalogSnapshot = catalog || {};
                renderDynamicCatalog(catalog);
                renderAdminCatalogList(catalog);
                updateDynamicSidebar(catalog);
            });

            subscribeSystemLogs();
        }



        const CATEGORY_GRID_MAP = {
            "semi-rangos": "#semi-anarquico .grid",
            "vanilla-rangos": "#vanilla-rangos .grid",
            "semi-kits": "#semi-kits .grid",
            "vanilla-kits": "#vanilla-kits .grid"
        };

        function renderDynamicCatalog(catalog) {
            // Inyecta los kits dinámicos directamente en los .grid de las secciones originales
            Object.entries(CATEGORY_GRID_MAP).forEach(([catKey, selector]) => {
                const grid = document.querySelector(selector);
                if (!grid) return;

                // Guardar HTML estático original una sola vez
                if (!grid.dataset.staticHtml) {
                    grid.dataset.staticHtml = grid.innerHTML;
                }

                const cat = (catalog || {})[catKey];
                const kits = cat && cat.kits ? Object.values(cat.kits) : [];

                if (!cat || kits.length === 0) {
                    // Si no hay categoría o no tiene kits, restaurar diseño original
                    grid.innerHTML = grid.dataset.staticHtml;
                    return;
                }

                // Renderizar sólo desde Firebase para esta categoría
                grid.innerHTML = "";
                kits.forEach(kit => {
                    if (!kit) return;
                    const card = document.createElement("div");
                    card.className = "card";
                    const descList = (kit.benefits || []).map(b => `<li><i class="fas fa-check icon-list"></i> ${b}</li>`).join("");
                    const imgHtml = kit.imageUrl ? `
                        <div class="kit-image-container">
                            <img src="${kit.imageUrl}" alt="${kit.name}" class="kit-image">
                        </div>` : "";
                    const cartName = kit.cartName || kit.displayName || kit.name;
                    const price = parseFloat(kit.price || 0);
                    card.innerHTML = `
                        ${imgHtml}
                        <h3>${kit.displayName || kit.name}</h3>
                        <div class="price-tag">
                            <span class="currency-symbol">$</span>
                            <span class="amount" data-m="${price.toFixed(2)}" data-p="${price.toFixed(2)}">${price.toFixed(2)}</span>
                            <span class="currency-code">USD</span>
                        </div>
                        <ul>${descList}</ul>
                        <button class="btn-add" onclick="addToCart('${cartName}', this)">Añadir</button>
                    `;
                    grid.appendChild(card);
                });
            });
        }

        function updateDynamicSidebar(catalog) {
            const sidebar = document.querySelector(".sidebar");
            if (!sidebar) return;
            let container = document.getElementById("dynamic-nav-container");
            if (!container) {
                container = document.createElement("div");
                container.id = "dynamic-nav-container";
                sidebar.appendChild(container);
            }
            container.innerHTML = "";

            const entries = Object.entries(catalog || {}).filter(([catKey]) => CATEGORY_GRID_MAP[catKey]);
            if (entries.length === 0) return;

            const title = document.createElement("div");
            title.className = "nav-category-title";
            title.textContent = "CATÁLOGO DINÁMICO";
            container.appendChild(title);

            entries.forEach(([catKey, cat]) => {
                const name = cat && cat.name ? cat.name : catKey;
                const selector = CATEGORY_GRID_MAP[catKey];
                const targetSection = selector ? selector.split(" ")[0] : null;
                const link = document.createElement("a");
                link.href = targetSection || "#";
                link.className = "nav-item";
                link.textContent = name;
                container.appendChild(link);
            });
        }

        function renderAdminCatalogList(catalog) {
            const container = document.getElementById("admin-catalog-list");
            if (!container) return;
            container.innerHTML = "";

            const entries = Object.entries(catalog || {});
            if (entries.length === 0) {
                container.innerHTML = '<div style="color:#777;">No hay categorías creadas aún.</div>';
                return;
            }

            entries.forEach(([catKey, cat]) => {
                const catDiv = document.createElement("div");
                catDiv.style.marginBottom = "6px";
                const name = cat && cat.name ? cat.name : catKey;

                let html = `<div><strong>${name}</strong> <small style="color:#777;">(${catKey})</small>
                    <button class="admin-btn" style="padding:4px 8px; font-size:0.7rem; margin-left:6px;" onclick="renameCategory('${catKey}')">Renombrar</button>
                    <button class="admin-btn" style="padding:4px 8px; font-size:0.7rem; margin-left:4px; background:#ff4747;" onclick="deleteCategory('${catKey}')">Borrar</button>
                </div>`;

                const kits = (cat && cat.kits) ? Object.entries(cat.kits) : [];
                if (kits.length > 0) {
                    html += `<div style="margin-left:10px; margin-top:3px;">`;
                    kits.forEach(([kitKey, kit]) => {
                        const kitName = kit && (kit.displayName || kit.name) ? (kit.displayName || kit.name) : kitKey;
                        html += `<div style="margin-bottom:2px;">- ${kitName}
                            <button class="admin-btn" style="padding:3px 6px; font-size:0.65rem; margin-left:4px;" onclick="startEditKit('${catKey}','${kitKey}')">Editar</button>
                            <button class="admin-btn" style="padding:3px 6px; font-size:0.65rem; margin-left:2px; background:#ff4747;" onclick="deleteKit('${catKey}','${kitKey}')">Borrar</button>
                        </div>`;
                    });
                    html += `</div>`;
                }

                catDiv.innerHTML = html;
                container.appendChild(catDiv);
            });
        }

        function renameCategory(catKey) {
            const cat = currentCatalogSnapshot && currentCatalogSnapshot[catKey];
            const currentName = cat && cat.name ? cat.name : catKey;
            const newName = prompt("Nuevo nombre para la categoría:", currentName);
            if (!newName) return;
            dbRefs.catalog.child(catKey).child("name").set(newName);
        }

        function deleteCategory(catKey) {
            if (!confirm("¿Eliminar esta categoría y todos sus kits?")) return;
            dbRefs.catalog.child(catKey).remove();
        }

        function startEditKit(catKey, kitKey) {
            const cat = currentCatalogSnapshot && currentCatalogSnapshot[catKey];
            if (!cat || !cat.kits || !cat.kits[kitKey]) return;
            const kit = cat.kits[kitKey];

            const catNameEl = document.getElementById("admin-category-name");
            const catKeyEl = document.getElementById("admin-category-key");
            const nameEl = document.getElementById("admin-kit-name");
            const imgEl = document.getElementById("admin-kit-image");
            const priceEl = document.getElementById("admin-kit-price");
            const descEl = document.getElementById("admin-kit-description");
            const statusEl = document.getElementById("admin-kit-status");

            if (!catNameEl || !catKeyEl || !nameEl || !imgEl || !priceEl || !descEl || !statusEl) return;

            catNameEl.value = cat.name || catKey;
            catKeyEl.value = catKey;
            nameEl.value = kit.displayName || kit.name || "";
            imgEl.value = kit.imageUrl || "";
            priceEl.value = kit.price || "";
            descEl.value = (kit.benefits || []).join("\n");

            editingCatKey = catKey;
            editingKitKey = kitKey;
            statusEl.style.color = "#ffd700";
            statusEl.textContent = "Editando kit existente. Guarda para aplicar cambios.";
        }

        function deleteKit(catKey, kitKey) {
            if (!confirm("¿Eliminar este kit?")) return;
            dbRefs.catalog.child(catKey).child("kits").child(kitKey).remove();
        }

        async function adminLogin() {
            const input = document.getElementById("admin-password");
            const errorBox = document.getElementById("admin-login-error");
            if (!input || !errorBox) return;
            const pwd = input.value;
            if (!pwd) {
                errorBox.textContent = "Ingresa la contraseña.";
                return;
            }
            try {
                const normalizedUser = (globalUser || "").toLowerCase();
                if (normalizedUser !== "lachispa1122") {
                    errorBox.textContent = "Solo el usuario lachispa1122 puede acceder al panel.";
                    return;
                }
                const hash = await hashStringSHA512(pwd);
                if (hash === ADMIN_HASH) {
                    document.getElementById("admin-login-box").style.display = "none";
                    document.getElementById("admin-content").style.display = "block";
                    errorBox.textContent = "";
                    loadStats();
                } else {
                    errorBox.textContent = "Contraseña incorrecta.";
                }
            } catch (e) {
                errorBox.textContent = "Error de autenticación.";
            }
        }

        function saveNewKit() {
            const catNameEl = document.getElementById("admin-category-name");
            const catKeyEl = document.getElementById("admin-category-key");
            const nameEl = document.getElementById("admin-kit-name");
            const imgEl = document.getElementById("admin-kit-image");
            const priceEl = document.getElementById("admin-kit-price");
            const descEl = document.getElementById("admin-kit-description");
            const statusEl = document.getElementById("admin-kit-status");

            if (!catNameEl || !catKeyEl || !nameEl || !priceEl || !descEl || !statusEl) return;

            let catKey = (catKeyEl.value || "").trim();
            const catName = (catNameEl.value || "").trim();
            const kitName = (nameEl.value || "").trim();
            const price = parseFloat(priceEl.value || "0");
            const img = (imgEl.value || "").trim();
            const benefits = (descEl.value || "").split(/\r?\n/).map(l => l.trim()).filter(Boolean);

            if (!catKey || !catName || !kitName || !price) {
                statusEl.style.color = "#ff5555";
                statusEl.textContent = "Completa categoría, nombre y precio.";
                return;
            }

            const kitDataToSave = {
                name: kitName,
                displayName: kitName,
                cartName: kitName,
                imageUrl: img,
                price: price,
                benefits: benefits
            };

            // Si estamos editando un kit existente, no cambiamos la clave de categoría
            if (editingCatKey && editingKitKey) {
                catKey = editingCatKey;
                const kitRef = dbRefs.catalog.child(catKey).child("kits").child(editingKitKey);
                kitRef.set(kitDataToSave, err => {
                    if (err) {
                        statusEl.style.color = "#ff5555";
                        statusEl.textContent = "Error al guardar cambios.";
                    } else {
                        statusEl.style.color = "#00ff88";
                        statusEl.textContent = "Kit actualizado correctamente.";
                        editingCatKey = null;
                        editingKitKey = null;
                    }
                });
            } else {
                const catRef = dbRefs.catalog.child(catKey);
                catRef.child("name").set(catName);
                catRef.child("kits").push(kitDataToSave, err => {
                    if (err) {
                        statusEl.style.color = "#ff5555";
                        statusEl.textContent = "Error al guardar.";
                    } else {
                        statusEl.style.color = "#00ff88";
                        statusEl.textContent = "Kit guardado correctamente.";
                        nameEl.value = "";
                        imgEl.value = "";
                        priceEl.value = "";
                        descEl.value = "";
                    }
                });
            }
        }


        function saveCoupon() {
            const codeEl = document.getElementById("admin-coupon-code");
            const percentEl = document.getElementById("admin-coupon-percent");
            const statusEl = document.getElementById("admin-coupon-status");
            if (!codeEl || !percentEl || !statusEl) return;

            const rawCode = (codeEl.value || "").trim();
            const percent = parseInt(percentEl.value || "0", 10);
            if (!rawCode || !percent || percent <= 0) {
                statusEl.style.color = "#ff5555";
                statusEl.textContent = "Ingresa un código y un porcentaje válido.";
                return;
            }
            const code = rawCode.toUpperCase();
            const data = {
                code,
                percent,
                active: true,
                createdAt: Date.now()
            };
            dbRefs.coupons.child(code).set(data, err => {
                if (err) {
                    console.error("Error guardando cupón:", err);
                    statusEl.style.color = "#ff5555";
                    statusEl.textContent = "Error al guardar cupón.";
                } else {
                    statusEl.style.color = "#00ff88";
                    statusEl.textContent = "Cupón guardado.";
                    codeEl.value = "";
                    percentEl.value = "";
                }
            });
        }

        function renderCouponsList(coupons) {
            const container = document.getElementById("admin-coupons-list");
            if (!container) return;
            container.innerHTML = "";
            const entries = Object.entries(coupons || {});
            if (entries.length === 0) {
                container.innerHTML = '<div style="color:#777;">Sin cupones.</div>';
                return;
            }
            entries.forEach(([code, data]) => {
                const row = document.createElement("div");
                row.style.display = "flex";
                row.style.justifyContent = "space-between";
                row.style.alignItems = "center";
                row.style.marginBottom = "3px";
                const label = document.createElement("span");
                label.textContent = `${code} → ${data.percent || 0}%`;
                const btn = document.createElement("button");
                btn.className = "admin-btn";
                btn.style.padding = "3px 6px";
                btn.style.fontSize = "0.65rem";
                btn.style.background = "#ff4747";
                btn.textContent = "Borrar";
                btn.onclick = () => deleteCoupon(code);
                row.appendChild(label);
                row.appendChild(btn);
                container.appendChild(row);
            });
        }

        function deleteCoupon(code) {
            if (!confirm(`¿Eliminar el cupón ${code}?`)) return;
            dbRefs.coupons.child(code).remove(err => {
                if (err) console.error("Error eliminando cupón:", err);
            });
        }

        function showPurchaseToast(order) {
            const container = document.getElementById("toast-container");
            if (!container || !order || !order.items) return;

            const who = order.user || order.username || "Un jugador";
            const firstItem = order.items[0];
            const what = firstItem ? firstItem.name || firstItem.productName || "un paquete" : "un paquete";

            const toast = document.createElement("div");
            toast.className = "toast";
            toast.innerHTML = `
                <span class="toast-icon"><i class="fas fa-shopping-basket"></i></span>
                <span><strong>${who}</strong> acaba de comprar <strong>${what}</strong>.</span>
            `;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = "0";
                toast.style.transform = "translateX(-10px)";
                setTimeout(() => toast.remove(), 300);
            }, 6000);
        }

        function loadStats() {
            dbRefs.recentPurchases.once("value").then(snapshot => {
                const data = snapshot.val() || {};
                let total = 0;
                const couponCount = {};
                const productCount = {};

                Object.values(data).forEach(order => {
                    if (!order) return;
                    const amount = order.totalFinal || order.total || 0;
                    total += parseFloat(amount) || 0;

                    if (order.couponCode) {
                        couponCount[order.couponCode] = (couponCount[order.couponCode] || 0) + 1;
                    }

                    (order.items || []).forEach(item => {
                        const name = item.name || item.productName;
                        if (!name) return;
                        productCount[name] = (productCount[name] || 0) + 1;
                    });
                });

                const totalEl = document.getElementById("stat-total");
                const couponEl = document.getElementById("stat-top-coupon");
                const topProductsEl = document.getElementById("stat-top-products");
                if (totalEl) totalEl.textContent = total.toFixed(2);

                if (couponEl) {
                    const entries = Object.entries(couponCount);
                    if (entries.length === 0) {
                        couponEl.textContent = "Sin datos";
                    } else {
                        entries.sort((a, b) => b[1] - a[1]);
                        couponEl.textContent = `${entries[0][0]} (${entries[0][1]} usos)`;
                    }
                }

                if (topProductsEl) {
                    topProductsEl.innerHTML = "";
                    const entries = Object.entries(productCount).sort((a, b) => b[1] - a[1]).slice(0, 3);
                    entries.forEach(([name, count]) => {
                        const li = document.createElement("li");
                        li.textContent = `${name} (${count})`;
                        topProductsEl.appendChild(li);
                    });
                    if (entries.length === 0) {
                        const li = document.createElement("li");
                        li.textContent = "Sin datos";
                        topProductsEl.appendChild(li);
                    }
                }
            });
        }

        // --- DATA ---
        const kitImages = {
            'cobre': 'https://i.postimg.cc/PxFZp50K/cobre.png',
            'hierro': 'https://i.postimg.cc/HkCM7KPJ/hierro.png',
            'oro': 'https://i.postimg.cc/3NvykCX8/oro.png',
            'diamante': 'https://i.postimg.cc/bYsBw65V/diamante.png',
            'esmeralda': 'https://i.postimg.cc/rwLngqpX/esmeralda.png',
            'netherite': 'https://i.postimg.cc/pdss28Y3/netherita.png',
            'aprendiz': 'https://i.postimg.cc/pLX8PSGr/Captura-de-pantalla-2026-02-02-203107.png',
            'explorador': 'https://i.postimg.cc/bv42Hwz1/explorador.png',
            'guerrero': 'https://i.postimg.cc/L5pYwQg4/Captura-de-pantalla-2026-02-02-203142.png',
            'epico': 'https://i.postimg.cc/CMGfk09n/Captura-de-pantalla-2026-02-02-203155.png',
            'heroe': 'https://i.postimg.cc/4xSKsxHF/Captura-de-pantalla-2026-02-02-203208.png',
            'leyenda': 'https://i.postimg.cc/Kzn4P7qp/Captura-de-pantalla-2026-02-02-203235.png',
            'intoxicado': 'https://i.postimg.cc/mkBk8cKS/Captura-de-pantalla-2026-02-02-203219.png'
        };

        const kitData = {
            'cobre': `<li><strong>Casco de Hierro</strong><span>Protección I, Irrompibilidad III, Reparación</span></li><li><strong>Pechera de Hierro</strong><span>Protección I, Irrompibilidad III, Reparación</span></li><li><strong>Pantalones de Hierro</strong><span>Protección I, Irrompibilidad III, Reparación</span></li><li><strong>Botas de Hierro</strong><span>Protección I, Irrompibilidad III, Reparación</span></li><li><strong>Espada de Hierro</strong><span>Filo I, Irrompibilidad II</span></li><li><strong>Pico de Hierro</strong><span>Eficiencia I, Irrompibilidad II</span></li><li><strong>Hacha de Hierro</strong><span>Eficiencia III, Irrompibilidad II</span></li><li><strong>Pala de Hierro</strong><span>Eficiencia II, Irrompibilidad II</span></li>`,
            'hierro': `<li><strong>Casco de Hierro</strong><span>Protección II, Irrompibilidad III, Reparación</span></li><li><strong>Pechera de Hierro</strong><span>Protección II, Irrompibilidad III, Reparación</span></li><li><strong>Pantalones de Hierro</strong><span>Protección II, Irrompibilidad III, Reparación</span></li><li><strong>Botas de Hierro</strong><span>Protección II, Irrompibilidad III, Reparación</span></li><li><strong>Espada de Hierro</strong><span>Filo III, Irrompibilidad III, Reparación</span></li><li><strong>Pico de Hierro</strong><span>Eficiencia III, Irrompibilidad III, Reparación</span></li><li><strong>Hacha de Hierro</strong><span>Eficiencia IV, Irrompibilidad III, Reparación</span></li><li><strong>Pala de Hierro</strong><span>Eficiencia III, Irrompibilidad III, Reparación</span></li><li><strong>Arco</strong><span>Poder II, Irrompibilidad III</span></li>`,
            'oro': `<li><strong>Casco de Diamante</strong><span>Protección II, Irrompibilidad III, Reparación</span></li><li><strong>Pechera de Diamante</strong><span>Protección II, Irrompibilidad III, Reparación</span></li><li><strong>Pantalones de Diamante</strong><span>Protección II, Irrompibilidad III, Reparación</span></li><li><strong>Botas de Diamante</strong><span>Protección II, Irrompibilidad III, Reparación</span></li><li><strong>Espada de Diamante</strong><span>Filo IV, Irrompibilidad III</span></li><li><strong>Pico de Diamante</strong><span>Fortuna III, Eficiencia IV</span></li><li><strong>Hacha de Diamante</strong><span>Eficiencia V</span></li><li><strong>Pala de Diamante</strong><span>Eficiencia IV</span></li><li><strong>Arco</strong><span>Poder III</span></li>`,
            'diamante': `<li><strong>Casco de Diamante</strong><span>Protección IV, Irrompibilidad III, Reparación</span></li><li><strong>Pechera de Diamante</strong><span>Protección IV, Irrompibilidad III, Reparación</span></li><li><strong>Pantalones de Diamante</strong><span>Protección IV, Irrompibilidad III, Reparación</span></li><li><strong>Botas de Diamante</strong><span>Protección IV, Irrompibilidad III, Reparación</span></li><li><strong>Elytras</strong><span>Irrompibilidad III</span></li><li><strong>Espada de Diamante</strong><span>Filo V, Aspecto ígneo II, Irrompibilidad III</span></li><li><strong>Pico de Diamante</strong><span>Fortuna III, Eficiencia IV, Irrompibilidad III</span></li><li><strong>Hacha de Diamante</strong><span>Eficiencia V, Irrompibilidad III</span></li><li><strong>Pala de Diamante</strong><span>Eficiencia V, Irrompibilidad III</span></li><li><strong>Arco</strong><span>Poder III, Llama</span></li>`,
            'esmeralda': `<li><strong>Casco de Diamante</strong><span>Prot IV, Respiración III, Afinidad Acuática, Irromp III, Reparación</span></li><li><strong>Pechera de Diamante</strong><span>Protección IV, Irrompibilidad III, Reparación</span></li><li><strong>Pantalones de Diamante</strong><span>Protección IV, Irrompibilidad III, Reparación</span></li><li><strong>Botas de Diamante</strong><span>Prot IV, Caída de Pluma IV, Irrompibilidad III, Reparación</span></li><li><strong>Elytras</strong><span>Irrompibilidad III, Reparación</span></li><li><strong>Espada de Diamante</strong><span>Filo V, Aspecto ígneo II, Empuje II, Irromp III, Reparación</span></li><li><strong>Pico de Diamante</strong><span>Fortuna III, Eficiencia V, Irromp III, Reparación</span></li><li><strong>Hacha de Diamante</strong><span>Eficiencia V, Irrompibilidad III, Reparación</span></li><li><strong>Pala de Diamante</strong><span>Eficiencia V, Irrompibilidad III, Reparación</span></li><li><strong>Arco</strong><span>Poder III, Llama, Reparación</span></li>`,
            'netherite': `<li><strong>Casco de Netherite</strong><span>Prot III, Respiración III, Afinidad Acuática, Irromp III, Reparación</span></li><li><strong>Pechera de Netherite</strong><span>Protección III, Irrompibilidad III, Reparación</span></li><li><strong>Pantalones de Netherite</strong><span>Protección III, Irrompibilidad III, Reparación</span></li><li><strong>Botas de Netherite</strong><span>Prot III, Caída Pluma IV, Vel. Alma III, Irromp III, Reparación</span></li><li><strong>Elytras</strong><span>Protección IV, Irrompibilidad III, Reparación</span></li><li><strong>Espada de Netherite</strong><span>Filo IV, Empuje II, Botín III, Irrompibilidad III, Reparación</span></li><li><strong>Pico de Netherite</strong><span>Fortuna III, Eficiencia IV, Irrompibilidad III, Reparación</span></li><li><strong>Hacha de Netherite</strong><span>Eficiencia IV, Irrompibilidad III, Reparación</span></li><li><strong>Pala de Netherite</strong><span>Eficiencia IV, Irrompibilidad III, Reparación</span></li><li><strong>Arco</strong><span>Poder III, Llama, Empuje II, Reparación</span></li>`,
            'aprendiz': `<li><strong>Casco de Hierro</strong><span>Protección I, Irrompibilidad III</span></li><li><strong>Pechera de Hierro</strong><span>Protección I, Irrompibilidad III</span></li><li><strong>Pantalones de Hierro</strong><span>Protección I, Irrompibilidad III</span></li><li><strong>Espada de Hierro</strong><span>Filo I, Irrompibilidad III</span></li><li><strong>Pico de Hierro</strong><span>Eficiencia I, Irrompibilidad III</span></li><li><strong>Pala de Hierro</strong><span>Eficiencia I, Irrompibilidad III</span></li><li><strong>Hacha de Hierro</strong><span>Eficiencia I, Irrompibilidad III</span></li><li><strong>Arco</strong><span>Poder I, Irrompibilidad III</span></li>`,
            'explorador': `<li><strong>Casco de Hierro</strong><span>Protección III, Irrompibilidad III</span></li><li><strong>Pechera de Hierro</strong><span>Protección III, Irrompibilidad III</span></li><li><strong>Pantalones de Hierro</strong><span>Protección III, Irrompibilidad III</span></li><li><strong>Botas de Hierro</strong><span>Protección III, Irrompibilidad III</span></li><li><strong>Espada de Hierro</strong><span>Filo III, Irrompibilidad III</span></li><li><strong>Pico de Hierro</strong><span>Fortuna II, Eficiencia III, Irrompibilidad III</span></li><li><strong>Hacha de Hierro</strong><span>Eficiencia III, Irrompibilidad III</span></li><li><strong>Arco</strong><span>Poder II</span></li>`,
            'guerrero': `<li><strong>Casco de Diamante</strong><span>Protección I, Irrompibilidad III</span></li><li><strong>Pechera de Diamante</strong><span>Protección I, Irrompibilidad III</span></li><li><strong>Pantalones de Diamante</strong><span>Protección I, Irrompibilidad III</span></li><li><strong>Botas de Diamante</strong><span>Protección I, Irrompibilidad III</span></li><li><strong>Espada de Hierro</strong><span>Filo V, Irrompibilidad III</span></li><li><strong>Pico de Hierro</strong><span>Eficiencia V, Irrompibilidad III</span></li><li><strong>Hacha de Diamante</strong><span>Eficiencia III, Irrompibilidad III</span></li><li><strong>Pala de Diamante</strong><span>Eficiencia III, Irrompibilidad III</span></li><li><strong>Arco</strong><span>Poder II, Irrompibilidad III</span></li>`,
            'epico': `<li><strong>Casco de Diamante</strong><span>Protección II, Irrompibilidad III, Reparación</span></li><li><strong>Pechera de Diamante</strong><span>Protección II, Irrompibilidad III, Reparación</span></li><li><strong>Pantalones de Diamante</strong><span>Protección II, Irrompibilidad III, Reparación</span></li><li><strong>Botas de Diamante</strong><span>Protección II, Irrompibilidad III, Reparación</span></li><li><strong>Espada de Diamante</strong><span>Filo III, Irrompibilidad III, Reparación</span></li><li><strong>Pico de Diamante</strong><span>Eficiencia III, Irrompibilidad III, Reparación</span></li><li><strong>Hacha de Diamante</strong><span>Eficiencia III, Irrompibilidad III, Reparación</span></li><li><strong>Pala de Diamante</strong><span>Eficiencia III, Irrompibilidad III, Reparación</span></li><li><strong>Arco</strong><span>Poder II, Irrompibilidad III, Reparación</span></li>`,
            'heroe': `<li><strong>Casco de Diamante</strong><span>Protección III, Irrompibilidad III, Reparación</span></li><li><strong>Pechera de Diamante</strong><span>Protección III, Irrompibilidad III, Reparación</span></li><li><strong>Pantalones de Diamante</strong><span>Protección III, Irrompibilidad III, Reparación</span></li><li><strong>Botas de Diamante</strong><span>Protección III, Irrompibilidad III, Reparación</span></li><li><strong>Espada de Diamante</strong><span>Filo IV, Aspecto Ígneo I, Irrompibilidad III, Reparación</span></li><li><strong>Pico de Diamante</strong><span>Fortuna III, Eficiencia IV, Irrompibilidad III, Reparación</span></li><li><strong>Hacha de Diamante</strong><span>Eficiencia IV, Irrompibilidad III, Reparación</span></li><li><strong>Pala de Diamante</strong><span>Eficiencia IV, Irrompibilidad III, Reparación</span></li><li><strong>Arco</strong><span>Poder IV, Fuego, Irrompibilidad III</span></li>`,
            'leyenda': `<li><strong>Casco de Diamante</strong><span>Prot IV, Irromp III, Afinidad Acuática, Reparación, Respiración III</span></li><li><strong>Pechera de Diamante</strong><span>Protección IV, Irrompibilidad III, Reparación</span></li><li><strong>Pantalones de Diamante</strong><span>Protección IV, Irrompibilidad III, Reparación</span></li><li><strong>Botas de Diamante</strong><span>Prot IV, Caída Pluma IV, Vel. Alma III, Irromp III, Reparación</span></li><li><strong>Espada de Diamante</strong><span>Filo V, Aspecto Ígneo II, Empuje II, Irromp III, Reparación</span></li><li><strong>Pico de Diamante</strong><span>Fortuna III, Eficiencia V, Irrompibilidad III, Reparación</span></li><li><strong>Pala de Diamante</strong><span>Eficiencia V, Irrompibilidad III, Reparación</span></li><li><strong>Hacha de Diamante</strong><span>Eficiencia V, Irrompibilidad III, Reparación</span></li><li><strong>Arco</strong><span>Poder V, Fuego, Irrompibilidad III</span></li>`,
            'intoxicado': `<li><strong>Casco de Netherite</strong><span>Prot IV, Irromp III, Afinidad Acuática, Reparación, Respiración III</span></li><li><strong>Pechera de Netherite</strong><span>Protección IV, Irrompibilidad III, Reparación</span></li><li><strong>Pantalones de Netherite</strong><span>Protección IV, Irrompibilidad III, Reparación</span></li><li><strong>Botas de Netherite</strong><span>Prot IV, Caída Pluma IV, Vel. Alma III, Irromp III, Reparación</span></li><li><strong>Espada de Netherite</strong><span>Filo V, Aspecto Ígneo II, Empuje II, Irromp III, Reparación</span></li><li><strong>Pico de Netherite</strong><span>Fortuna III, Eficiencia V, Irrompibilidad III, Reparación</span></li><li><strong>Pala de Netherite</strong><span>Eficiencia V, Irrompibilidad III, Reparación</span></li><li><strong>Hacha de Netherite</strong><span>Eficiencia V, Irrompibilidad III, Reparación</span></li>`
        };

        const faqData = {
            'buy': { title: "¿Cómo comprar?", text: "Selecciona el paquete que desees y añádelo al carrito. Al finalizar, haz clic en 'Generar Pedido'. Se copiará un texto en tu portapapeles. Ve a nuestro Discord, abre un ticket de compra y pega ese mensaje para que un administrador procese tu pago." },
            'discord': { title: "¿Cómo unirme al Discord?", text: "Puedes unirte haciendo clic en el botón 'Discord' en el menú lateral o en el botón azul 'Entrar a Discord' en la sección de bienvenida." },
            'payment': { title: "¿Métodos de pago?", text: "Aceptamos diversos métodos de pago dependiendo de tu país (PayPal, Criptomonedas, Transferencia Bancaria, etc.). Todos los detalles se coordinan directamente en el ticket de soporte." },
            'security': { title: "¿Es seguro?", text: "Totalmente. Todas las compras son gestionadas manualmente por los dueños del servidor (Polagodd y Chimii) para garantizar que recibas tus ítems sin problemas." }
        };

        // --- GLOBAL VARS ---
        let globalUser = "Invitado"; // Inicializada por defecto
        let skinViewer = null;
        let cart = [];
        let isPermanent = false;
        let currentClientIP = null;
        let currentCatalogSnapshot = {};
        let editingCatKey = null;
        let editingKitKey = null;
        let couponsCache = {};
        let appliedCouponCode = null;
        let appliedDiscountPercent = 0;

        // --- FUNCIONES SISTEMA ---
        function updateSkin() {
            const nick = document.getElementById("nick-input").value;
            const preview = document.getElementById("avatar-preview");
            const url = nick.length > 0 ? `https://minotar.net/helm/${nick}/100.png` : `https://minotar.net/helm/Steve/100.png`;
            preview.style.backgroundImage = `url('${url}')`;
        }

        function submitLogin() {
            const input = document.getElementById("nick-input");
            const val = input.value.trim();
            if(val === "") {
                input.style.borderColor = "red";
                setTimeout(() => input.style.borderColor = "#333", 1000);
                return;
            }
            globalUser = val; // Actualiza el usuario global
            document.getElementById("login-overlay").style.opacity = "0";
            setTimeout(() => {
                document.getElementById("login-overlay").style.display = "none";
                document.getElementById("terms-overlay").style.display = "flex";
                setTimeout(() => document.getElementById("terms-overlay").style.opacity = "1", 50);
            }, 500);
        }

        function enterShop() {
            document.getElementById("sidebar-username").innerText = globalUser;
            document.getElementById("sidebar-avatar").style.backgroundImage = `url('https://minotar.net/helm/${globalUser}/40.png')`;
            document.getElementById("cart-username").innerText = globalUser;
            document.getElementById("terms-overlay").style.opacity = "0";
            setTimeout(() => document.getElementById("terms-overlay").style.display = "none", 500);
            
            // Iniciar widget del servidor al entrar
            fetchServerStatus();
            setInterval(fetchServerStatus, 60000); 
            
            // Iniciar lógica de Firebase (ofertas, catálogo, toasts)
            initFirebaseRealtime();
        }

        function resetNavigation() {
            document.getElementById('scroll-container').scrollTop = 0;
            document.querySelectorAll('.submenu').forEach(el => el.classList.remove('show'));
            document.querySelectorAll('.submenu-toggle').forEach(el => el.classList.remove('open'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('btn-inicio').classList.add('active');
        }

        // --- CARRITO ---
        function openCart() { document.getElementById("cart-modal").style.display = "flex"; }
        function addToCart(name, btn) {
            console.log("DEBUG: addToCart called for:", name);
            const card = btn.closest('.card');
            let price = parseFloat(card.querySelector('.amount').innerText);
            let type = "Único";
            if(name.includes("Rango")) type = isPermanent ? "Permanente" : "Mensual";
            else type = "Paquete"; 
            cart.push({ name, price, type });
            updateCartUI();
            
            const originalText = btn.innerText;
            btn.innerText = "¡Listo!";
            btn.style.borderColor = "var(--success)";
            setTimeout(() => { btn.innerText = originalText; btn.style.borderColor = "var(--primary)"; }, 1000);
        }

        function removeFromCart(index) { cart.splice(index, 1); updateCartUI(); }

        function updateCartUI() {
            document.getElementById("cart-count").innerText = cart.length;
            const container = document.getElementById("cart-items-container");
            let subtotal = 0;
            
            if(cart.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Vacío</p>';
            } else {
                container.innerHTML = "";
                cart.forEach((item, index) => {
                    subtotal += item.price;
                    container.innerHTML += `
                        <div class="cart-item">
                            <div>${item.name} <small>(${item.type})</small></div>
                            <div>$${item.price.toFixed(2)} <i class="fas fa-trash" style="color:#ff5555; cursor:pointer; margin-left:10px;" onclick="removeFromCart(${index})"></i></div>
                        </div>`;
                });
            }

            let total = subtotal;
            if (appliedDiscountPercent > 0) {
                total = subtotal * (1 - appliedDiscountPercent / 100);
            }
            document.getElementById("cart-total-price").innerText = total.toFixed(2);
        }

        function toggleGiftInput() {
            const isGift = document.getElementById("is-gift").checked;
            document.getElementById("gift-nickname").style.display = isGift ? "block" : "none";
        }

        function applyCouponFromCart() {
            const input = document.getElementById("cart-coupon-input");
            const statusEl = document.getElementById("cart-coupon-status");
            if (!input || !statusEl) return;
            // Sanitización del cupón: solo alfanumérico
            const rawCode = (input.value || "").trim().replace(/[^a-zA-Z0-9]/g, '');
            input.value = rawCode; // Reflejar sanitización en el input

            if (!rawCode) {
                appliedCouponCode = null;
                appliedDiscountPercent = 0;
                statusEl.style.color = "#888";
                statusEl.textContent = "Sin cupón aplicado.";
                updateCartUI();
                return;
            }
            const code = rawCode.toUpperCase();
            const coupon = couponsCache && couponsCache[code];
            if (!coupon || coupon.active === false || !coupon.percent) {
                appliedCouponCode = null;
                appliedDiscountPercent = 0;
                statusEl.style.color = "#ff5555";
                statusEl.textContent = "Cupón inválido o inactivo.";
            } else {
                appliedCouponCode = code;
                appliedDiscountPercent = parseInt(coupon.percent, 10) || 0;
                statusEl.style.color = "#00ff88";
                statusEl.textContent = `Cupón aplicado: -${appliedDiscountPercent}%`;
            }
            updateCartUI();
        }

        async function checkout() {
            // Verificación de Integridad de Sesión (Session Key)
            if (!window._sK) {
                logSystem('security_alert', 'INTENTO DE ACCESO DIRECTO A CHECKOUT - Usuario: ' + (globalUser || 'Invitado'));
                alert("Error de seguridad: Sesión inválida.");
                return;
            }

            if (cart.length === 0) { alert("Carrito vacío"); return; }

            const isGift = document.getElementById("is-gift").checked;
            const giftNick = (document.getElementById("gift-nickname").value || "").trim().replace(/[^a-zA-Z0-9_]/g, '');
            const currentUser = globalUser || "Invitado";

            if (isGift && !giftNick) {
                alert("Por favor, ingresa el Nickname del destinatario (solo alfanumérico).");
                return;
            }

            // --- Obtener IP con checkout blindado (fallback 0.0.0.0) ---
            let resolvedIP = "0.0.0.0";
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 4000);
                const ipResp = await fetch("https://api.ipify.org?format=json", { signal: controller.signal });
                clearTimeout(timeoutId);
                const ipData = await ipResp.json();
                if (ipData && ipData.ip) resolvedIP = ipData.ip;
            } catch (e) {
                console.warn("No se pudo obtener IP pública, usando 0.0.0.0", e);
                try {
                    await logSystem("error", "Fallo obteniendo IP pública; usando 0.0.0.0", { error: (e && e.message) || String(e) });
                } catch (_) {}
            }
            currentClientIP = resolvedIP;

            const canOrder = await checkAntiSpam(currentClientIP);
            if (!canOrder) {
                alert("Has realizado demasiados pedidos recientemente. Intenta nuevamente en unos minutos.");
                return;
            }

            // --- Construir información de carrito (CON VALIDACIÓN DE SEGURIDAD) ---
            const items = [];
            let totalBase = 0;
            let totalFinal = 0;

            cart.forEach(i => {
                let officialPrice = 0;

                // 1. Intentar buscar en precios estáticos
                if (OFFICIAL_PRICES[i.name]) {
                    const priceData = OFFICIAL_PRICES[i.name];
                    if (typeof priceData === 'object') {
                        // Es un rango (Mensual/Permanente)
                        officialPrice = priceData[i.type] || 0;
                    } else {
                        // Es un kit estático
                        officialPrice = priceData;
                    }
                } 
                // 2. Si no es estático, buscar en el catálogo dinámico de Firebase
                else if (currentCatalogSnapshot) {
                    const kits = Object.values(currentCatalogSnapshot);
                    const dbKit = kits.find(k => k && k.displayName === i.name);
                    if (dbKit) {
                        officialPrice = parseFloat(dbKit.price) || 0;
                    }
                }

                // VALIDACIÓN DE FRAUDE: Comparar precio detectado en HTML (i.price) con el oficial
                const detectedPrice = parseFloat(i.price);
                if (Math.abs(detectedPrice - officialPrice) > 0.01) {
                    console.error("ALERTA DE SEGURIDAD: Discrepancia de precio detectada.", {
                        producto: i.name,
                        detectado: detectedPrice,
                        oficial: officialPrice
                    });
                    logSystem("security_alert", 'POSIBLE INTENTO DE MANIPULACIÓN DE PRECIOS - Usuario: ' + currentUser, {
                        producto: i.name,
                        precioHTML: detectedPrice,
                        precioOficial: officialPrice,
                        ip: currentClientIP
                    });
                }

                // USAR SIEMPRE EL PRECIO OFICIAL PARA EL CÁLCULO
                totalBase += officialPrice;
                totalFinal += officialPrice;
                items.push({
                    name: i.name,
                    type: i.type,
                    basePrice: officialPrice,
                    finalPrice: officialPrice,
                    hasOffer: false
                });
            });

            // --- Aplicar cupón al total final (si hay) ANTES de enviar a Discord ---
            if (appliedDiscountPercent > 0 && appliedCouponCode) {
                totalFinal = totalFinal * (1 - appliedDiscountPercent / 100);
            }

            const order = {
                user: currentUser,
                isGift,
                giftNick: isGift ? giftNick : null,
                items,
                totalBase,
                totalFinal,
                couponCode: appliedCouponCode || null,
                couponPercent: appliedDiscountPercent || 0,
                ip: currentClientIP,
                createdAt: Date.now()
            };

            // --- Persistencia en Firebase (obligatoria) ---
            let savedToFirebase = false;
            try {
                const newRef = dbRefs.recentPurchases.push();
                await newRef.set(order);

                const ipKey = (order.ip || "0.0.0.0").replace(/\./g, '_');
                const ipRef = dbRefs.ipOrders.child(ipKey).push();
                await ipRef.set({ createdAt: order.createdAt });
                savedToFirebase = true;
            } catch (e) {
                console.error("Error guardando pedido en Firebase:", e);
                try {
                    await logSystem("error", "Fallo guardando pedido en Firebase", { error: (e && e.message) || String(e) });
                } catch (_) {}
            }

            // --- Webhook de Discord en try/catch independiente ---
            try {
                await sendDiscordWebhook(order);
            } catch (e) {
                console.error("Error en webhook (ignorando para no romper checkout):", e);
                try {
                    await logSystem("error", "Fallo enviando webhook de Discord", { error: (e && e.message) || String(e) });
                } catch (_) {}
            }

            // --- Mensaje para el jugador + portapapeles (SIEMPRE se intenta) ---
            let msg = "";
            if (isGift) {
                msg = `¡Hola! Quiero realizar una compra para REGALAR.\n👤 De: ${currentUser}\n🎁 Para: ${giftNick}\n--------------------------------\n`;
            } else {
                msg = `¡Hola! Quiero realizar una compra.\n👤 Usuario: ${currentUser}\n--------------------------------\n`;
            }
            items.forEach(i => {
                msg += `• ${i.name} [[${i.type}]] - $${i.finalPrice.toFixed(2)}\n`;
            });
            msg += `--------------------------------\n💰 TOTAL: $${totalFinal.toFixed(2)} USD\n`;
            if (appliedDiscountPercent > 0 && appliedCouponCode) {
                msg += `Descuento: ${appliedCouponCode} - ${appliedDiscountPercent}% desc.\n`;
            }
            msg += `He leído y acepto los Términos y Condiciones.\nEspero instrucciones de pago.`;

            let clipboardOk = true;
            try {
                await navigator.clipboard.writeText(msg);
            } catch (e) {
                clipboardOk = false;
                console.error("No se pudo copiar al portapapeles:", e);
            }

            // --- Feedback final al jugador ---
            if (!savedToFirebase) {
                alert("Tu pedido se generó, pero hubo un problema al registrarlo en el sistema. El detalle fue copiado (si es posible), pégalo en tu ticket y avisa al staff.");
                return;
            }

            // Reproducir sonido justo antes del alert de éxito
            try {
                const successSound = new Audio("https://www.myinstants.com/media/sounds/apple-pay-45496.mp3.");
                successSound.play().catch(() => {});
            } catch (e) {
                console.warn("No se pudo reproducir el sonido de éxito:", e);
            }

            startDiscordRedirectCountdown(5, clipboardOk);
        }

        async function checkAntiSpam(ip) {
            if (!ip) return true;
            const ipKey = ip.replace(/\./g, '_');
            const snap = await dbRefs.ipOrders.child(ipKey).once("value");
            const data = snap.val() || {};
            const now = Date.now();
            const FIVE_MIN = 5 * 60 * 1000;
            const recent = Object.values(data).filter(o => o && (now - o.createdAt) <= FIVE_MIN);
            return recent.length < 3;
        }

        async function sendDiscordWebhook(order) {
            const url = WEBHOOK_URL;
            if (!url) return;
            try {
                const lines = order.items.map(i => {
                    const base = `• ${i.name} [[${i.type}]] - $${i.finalPrice.toFixed(2)}`;
                    if (order.couponCode && order.couponPercent > 0) {
                        return `${base} (Cupón aplicado: ${order.couponCode} - ${order.couponPercent}% desc.)`;
                    }
                    return base;
                }).join("\\n");
                const body = {
                    content: null,
                    embeds: [
                        {
                            title: "Nuevo pedido en Enderland",
                            color: 0x9d00ff,
                            fields: [
                                { name: "Jugador", value: order.user || "Desconocido", inline: true },
                                { name: "Es regalo", value: order.isGift ? `Sí → ${order.giftNick || "-"}` : "No", inline: true },
                                { name: "Total", value: `$${(order.totalFinal || 0).toFixed(2)} USD`, inline: true },
                                { name: "Paquetes", value: lines || "-", inline: false },
                                { name: "IP Cliente", value: order.ip || "0.0.0.0", inline: false }
                            ],
                            footer: { text: new Date(order.createdAt).toLocaleString() },
                            timestamp: new Date(order.createdAt).toISOString()
                        }
                    ]
                };
                await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(body)
                });
            } catch (e) {
                console.error("Error enviando webhook:", e);
                try {
                    await logSystem("error", "Fallo enviando webhook de Discord", { error: (e && e.message) || String(e) });
                } catch (_) {}
            }
        }

        function subscribeSystemLogs() {
            const logRef = dbRefs.systemLogs;
            if (!logRef) return;
            logRef.limitToLast(100).on("child_added", snap => {
                const entry = snap.val();
                if (!entry) return;
                appendAdminLog(entry);
            });
        }

        function appendAdminLog(entry) {
            const box = document.getElementById("admin-console-log");
            if (!box) return;

            const ts = entry.timestamp || entry.createdAt || Date.now();
            const level = (entry.level || "info").toUpperCase();
            const msg = entry.message || entry.error || JSON.stringify(entry);
            const line = document.createElement("div");
            const date = new Date(ts);
            line.textContent = `[${date.toLocaleTimeString()}] [${level}] ${msg}`;
            box.appendChild(line);

            while (box.childNodes.length > 200) {
                box.removeChild(box.firstChild);
            }
            box.scrollTop = box.scrollHeight;
        }

        async function logSystem(level, message, context) {
            try {
                const payload = {
                    level: level || "info",
                    message: message || "",
                    context: context || null,
                    timestamp: Date.now()
                };
                console[level === "error" ? "error" : "log"](`#admin-console-log ${payload.message}`, payload.context || "");
                if (dbRefs && dbRefs.systemLogs) {
                    const ref = dbRefs.systemLogs.push();
                    await ref.set(payload);
                }
            } catch (e) {
                console.error("#admin-console-log No se pudo registrar en system_logs:", e);
            }
        }

        function startDiscordRedirectCountdown(seconds, clipboardOk) {
            const container = document.getElementById("toast-container");
            if (!container) return;
            const toast = document.createElement("div");
            toast.className = "toast";
            const baseMsg = clipboardOk
                ? "Pedido copiado con éxito. Abre ticket en el servidor de Discord, direccionando en"
                : "Pedido generado. Abre ticket en el servidor de Discord, direccionando en";
            let s = seconds;
            toast.innerHTML = `<span class="toast-icon"><i class="fas fa-bell"></i></span><span>${baseMsg} ${s}</span>`;
            container.appendChild(toast);
            const iv = setInterval(() => {
                s -= 1;
                toast.innerHTML = `<span class="toast-icon"><i class="fas fa-bell"></i></span><span>${baseMsg} ${s}</span>`;
                if (s <= 0) {
                    clearInterval(iv);
                    setTimeout(() => toast.remove(), 1000);
                    window.open("https://discord.gg/wmS4Ztg8Af", "_blank");
                    window.open("https://discord.gg/wmS4Ztg8Af", "_blank");
                }
            }, 1000);
        }


        // --- PRECIOS ---
        function togglePrice(sender) {
            if(sender) {
                isPermanent = sender.checked;
                const otherSwitchId = sender.id === 'price-switch-semi' ? 'price-switch-vanilla' : 'price-switch-semi';
                const otherSwitch = document.getElementById(otherSwitchId);
                if(otherSwitch) otherSwitch.checked = isPermanent;
            } else {
                isPermanent = document.getElementById('price-switch-semi').checked;
            }
            const labelSemiM = document.getElementById("label-month-semi");
            const labelSemiP = document.getElementById("label-perm-semi");
            if(labelSemiM && labelSemiP) {
                labelSemiM.classList.toggle("active", !isPermanent);
                labelSemiP.classList.toggle("active", isPermanent);
            }
            const labelVanM = document.getElementById("label-month-vanilla");
            const labelVanP = document.getElementById("label-perm-vanilla");
            if(labelVanM && labelVanP) {
                labelVanM.classList.toggle("active", !isPermanent);
                labelVanP.classList.toggle("active", isPermanent);
            }
            document.querySelectorAll(".amount").forEach(el => {
                el.innerText = isPermanent ? el.getAttribute("data-p") : el.getAttribute("data-m");
            });
            if(cart.length > 0) { cart = []; updateCartUI(); }
        }

        // --- MODALES EXTRA ---
        function showKitDetails(kitKey) {
            const modal = document.getElementById("kit-modal");
            const listContainer = document.getElementById("kit-modal-list");
            const title = document.getElementById("kit-modal-title");
            const img = document.getElementById("kit-modal-img");

            title.innerText = "CONTENIDO: KIT " + kitKey.toUpperCase();
            listContainer.innerHTML = kitData[kitKey] || "<li>Información no disponible</li>";
            
            if(kitImages[kitKey]) {
                img.src = kitImages[kitKey];
                img.style.display = "block";
            } else {
                img.style.display = "none";
            }
            modal.style.display = "flex";
        }
        
        function openFAQ(id) {
            const modal = document.getElementById("faq-modal");
            const title = document.getElementById("faq-title");
            const body = document.getElementById("faq-body");
            const data = faqData[id];

            if(data) {
                title.innerText = data.title;
                body.innerText = data.text;
                modal.style.display = "flex";
            }
        }

        function showFullSkin() {
            if(globalUser === "Invitado") return;
            const modal = document.getElementById("skin-modal");
            document.getElementById("skin-username-display").innerText = globalUser;
            modal.style.display = "flex";

            if(skinViewer) {
                skinViewer.loadSkin(`https://minotar.net/skin/${globalUser}`);
            } else {
                skinViewer = new skinview3d.SkinViewer({
                    canvas: document.getElementById("skin_container"),
                    width: 300, height: 300, skin: `https://minotar.net/skin/${globalUser}`
                });
                skinViewer.width = document.getElementById("skin-viewer-container").clientWidth;
                skinViewer.height = 300;
                skinViewer.loadCape(null);
                skinViewer.animation = new skinview3d.WalkingAnimation();
                skinViewer.animation.speed = 1.0;
                let control = skinview3d.createOrbitControls(skinViewer);
                control.enableRotate = true; control.enableZoom = true;
            }
        }

        function copyIP() { navigator.clipboard.writeText("play.enderland.org"); alert("IP Copiada"); }

        // --- NAVIGATION SCROLL ---
        const mainContent = document.getElementById('scroll-container');
        const sections = document.querySelectorAll('section');
        const navItems = document.querySelectorAll('.sidebar a.nav-item');

        mainContent.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                if (mainContent.scrollTop >= (section.offsetTop - 150)) {
                    current = section.getAttribute('id');
                }
            });
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) {
                    item.classList.add('active');
                    if(current.includes('semi') || current.includes('vanilla')) {
                        let parentType = current.includes('kits') ? 'kits' : 'rangos';
                        document.getElementById('submenu-' + parentType).classList.add('show');
                        document.getElementById('toggle-' + parentType).classList.add('open');
                    }
                }
            });
        });

        function toggleSubmenu(id) {
            document.getElementById('submenu-' + id).classList.toggle('show');
            document.getElementById('toggle-' + id).classList.toggle('open');
        }

        // --- SERVER WIDGET & MODAL LOGIC ---
        function fetchServerStatus() {
            const ip = "play.enderland.org";
            const statusText = document.getElementById("server-status-text");
            const badge = document.getElementById("server-status-badge");
            const count = document.getElementById("player-count");
            const progress = document.getElementById("player-progress");
            const version = document.getElementById("server-version");
            const ping = document.getElementById("server-ping");

            fetch(`https://api.mcsrvstat.us/2/${ip}`)
                .then(response => response.json())
                .then(data => {
                    if (data.online) {
                        if(statusText) statusText.innerText = "ONLINE";
                        if(badge) badge.classList.remove("offline");
                        
                        const current = data.players.online;
                        const max = data.players.max;
                        if(count) count.innerHTML = `${current} <span>/ ${max}</span>`;
                        
                        const percentage = Math.min((current / max) * 100, 100);
                        if(progress) progress.style.width = `${percentage}%`;

                        if(version) version.innerText = data.version;
                        if(ping) ping.innerText = (data.debug && data.debug.ping ? data.debug.ping : "24") + " ms";
                    } else {
                        setOfflineMode();
                    }
                })
                .catch(err => {
                    console.error("Error al obtener estado:", err);
                    setOfflineMode();
                });

            function setOfflineMode() {
                if(statusText) statusText.innerText = "OFFLINE";
                if(badge) badge.classList.add("offline");
                if(count) count.innerHTML = "0 <span>/ 0</span>";
                if(progress) progress.style.width = "0%";
                if(version) version.innerText = "--";
                if(ping) ping.innerText = "--";
            }
        }

        // Función para abrir el modal al hacer click en el widget
        function openServerModal() {
            document.getElementById("server-modal").style.display = "flex";
            fetchServerDetails();
        }

        // Función para cargar lista de jugadores y detalles
        function fetchServerDetails() {
            const ip = "play.enderland.org";
            const container = document.getElementById("player-list-container");
            const motdElement = document.getElementById("server-motd");
            const countElement = document.getElementById("modal-online-count");

            container.innerHTML = '<div style="text-align:center; width:100%; color:#888;"><i class="fas fa-spinner fa-spin"></i> Cargando...</div>';

            fetch(`https://api.mcsrvstat.us/2/${ip}`)
                .then(response => response.json())
                .then(data => {
                    if (data.online) {
                        let cleanMotd = data.motd ? data.motd.clean.join("\n") : "Enderland Server";
                        motdElement.innerText = cleanMotd;
                        countElement.innerText = data.players.online;

                        if (data.players.list && data.players.list.length > 0) {
                            container.innerHTML = "";
                            data.players.list.forEach(player => {
                                let playerCard = document.createElement("div");
                                playerCard.style.background = "#1a1a1a";
                                playerCard.style.border = "1px solid #333";
                                playerCard.style.borderRadius = "5px";
                                playerCard.style.padding = "10px";
                                playerCard.style.display = "flex";
                                playerCard.style.flexDirection = "column";
                                playerCard.style.alignItems = "center";
                                playerCard.style.gap = "5px";

                                let img = document.createElement("img");
                                img.src = `https://minotar.net/helm/${player}/32.png`;
                                img.style.borderRadius = "4px";
                                
                                let name = document.createElement("span");
                                name.innerText = player;
                                name.style.fontSize = "0.85rem";
                                name.style.color = "#ccc";
                                name.style.overflow = "hidden";
                                name.style.textOverflow = "ellipsis";
                                name.style.maxWidth = "100%";

                                playerCard.appendChild(img);
                                playerCard.appendChild(name);
                                container.appendChild(playerCard);
                            });
                        } else {
                            container.innerHTML = '<p style="color: #666; width: 100%; text-align: center; grid-column: 1 / -1;">No hay jugadores visibles o la lista está oculta.</p>';
                        }
                    } else {
                        motdElement.innerText = "Servidor Offline";
                        container.innerHTML = '<p style="color: #ff4747; width: 100%; text-align: center;">El servidor está apagado.</p>';
                    }
                })
                .catch(err => {
                    container.innerHTML = '<p style="color: #ff4747; width: 100%; text-align: center;">Error al cargar datos.</p>';
                });
        }
    </script>
</body>
</html>
